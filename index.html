<!DOCTYPE html>
<html lang="uk" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Навігатор Стажера - Галя Балувана</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* CSS Variables for Theming */
        :root {
            --background: #f8f9fa; /* Softer light gray */
            --foreground: #212529; /* Softer black */
            --card-background: #ffffff;
            --card-foreground: #343a40;
            --muted-foreground: #6c757d;
            --primary: #fca311; /* Richer amber */
            --primary-foreground: #ffffff;
            --secondary-background: #e9ecef; /* Light gray for elements */
            --border: #dee2e6;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.08), 0 1px 2px -1px rgb(0 0 0 / 0.04);
            --success: #28a745;
            --success-foreground: #ffffff;
        }

        html.dark {
            --background: #181a1b; /* Rich dark background */
            --foreground: #e8e6e3; /* Soft white text */
            --card-background: #242627;
            --card-foreground: #f1f3f5;
            --muted-foreground: #adb5bd;
            --primary: #fcc419; /* Brighter yellow for dark mode */
            --primary-foreground: #181a1b;
            --secondary-background: #33373a;
            --border: #495057;
            --success: #20c997;
            --success-foreground: #181a1b;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background);
            color: var(--foreground);
            transition: background-color 0.3s, color 0.3s;
        }
        .main-page { display: block; }
        .sub-page { display: none; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .answer-option {
            border-width: 2px;
            transition: all 0.2s ease-in-out;
        }
    </style>
</head>
<body class="antialiased">

    <div class="container mx-auto max-w-lg min-h-screen" style="background-color: var(--card-background);">
        <!-- HEADER -->
        <header class="sticky top-0 z-10 border-b" style="background-color: var(--card-background); border-color: var(--border);">
            <div class="flex items-center justify-between p-4">
                <button id="backButton" class="invisible" style="color: var(--muted-foreground);">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                </button>
                <h1 id="headerTitle" class="text-xl font-bold" style="color: var(--card-foreground);">Навігатор Стажера</h1>
                <button id="theme-toggle" class="p-2 rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[var(--primary)]" style="color: var(--muted-foreground); background-color: var(--secondary-background);">
                    <i id="theme-icon" data-lucide="moon" class="w-5 h-5"></i>
                </button>
            </div>
        </header>

        <!-- MAIN CONTENT -->
        <main class="p-4 md:p-6 pb-20">

            <!-- Main Page -->
            <div id="main-page" class="main-page">
                <div class="text-center mb-6">
                    <div class="w-24 h-24 mx-auto mb-4 rounded-full flex items-center justify-center" style="background-color: var(--secondary-background);">
                        <img src="https://i.ibb.co/688w7Vq/image-f723c9.jpg" alt="Галя Балувана" class="h-20 w-20 rounded-full">
                    </div>
                    <h2 class="text-2xl font-bold" style="color: var(--card-foreground);">Ласкаво просимо, Анно!</h2>
                    <p style="color: var(--muted-foreground);">Ваш шлях у "Галя Балувана" починається тут.</p>
                </div>

                <!-- Progress -->
                <div class="mb-8">
                    <div class="flex justify-between mb-1">
                        <span class="text-base font-medium" style="color: var(--primary);">Ваш прогрес</span>
                        <span id="mainProgressText" class="text-sm font-medium" style="color: var(--primary);">5%</span>
                    </div>
                    <div class="w-full rounded-full h-2.5" style="background-color: var(--secondary-background);">
                        <div id="mainProgressBar" class="h-2.5 rounded-full" style="background-color: var(--primary); width: 5%; transition: width 0.5s ease-in-out;"></div>
                    </div>
                </div>

                <!-- Menu Grid -->
                <div class="grid grid-cols-2 gap-4">
                    <button data-page="plan-page" class="menu-card group flex flex-col items-center justify-center p-4 rounded-lg transition-transform transform hover:scale-105" style="background-color: var(--secondary-background); box-shadow: var(--shadow-sm);">
                        <div class="p-3 rounded-full mb-3" style="background-color: var(--card-background); box-shadow: var(--shadow);">
                            <i data-lucide="clipboard-list" class="w-8 h-8" style="color: var(--primary);"></i>
                        </div>
                        <span class="font-semibold text-center" style="color: var(--card-foreground);">План Навчання</span>
                    </button>
                     <button data-page="checklists-page" class="menu-card group flex flex-col items-center justify-center p-4 rounded-lg transition-transform transform hover:scale-105" style="background-color: var(--secondary-background); box-shadow: var(--shadow-sm);">
                         <div class="p-3 rounded-full mb-3" style="background-color: var(--card-background); box-shadow: var(--shadow);">
                            <i data-lucide="check-square" class="w-8 h-8" style="color: var(--primary);"></i>
                        </div>
                        <span class="font-semibold text-center" style="color: var(--card-foreground);">Чек-листи</span>
                    </button>
                    <button data-page="standards-page" class="menu-card group flex flex-col items-center justify-center p-4 rounded-lg transition-transform transform hover:scale-105" style="background-color: var(--secondary-background); box-shadow: var(--shadow-sm);">
                         <div class="p-3 rounded-full mb-3" style="background-color: var(--card-background); box-shadow: var(--shadow);">
                            <i data-lucide="gem" class="w-8 h-8" style="color: var(--primary);"></i>
                        </div>
                        <span class="font-semibold text-center" style="color: var(--card-foreground);">База Знань</span>
                    </button>
                    <button data-page="quiz-page" class="menu-card group flex flex-col items-center justify-center p-4 rounded-lg transition-transform transform hover:scale-105" style="background-color: var(--secondary-background); box-shadow: var(--shadow-sm);">
                         <div class="p-3 rounded-full mb-3" style="background-color: var(--card-background); box-shadow: var(--shadow);">
                            <i data-lucide="graduation-cap" class="w-8 h-8" style="color: var(--primary);"></i>
                        </div>
                        <span class="font-semibold text-center" style="color: var(--card-foreground);">Перевірка Знань</span>
                    </button>
                    <button data-page="products-page" class="menu-card group flex flex-col items-center justify-center p-4 rounded-lg transition-transform transform hover:scale-105" style="background-color: var(--secondary-background); box-shadow: var(--shadow-sm);">
                        <div class="p-3 rounded-full mb-3" style="background-color: var(--card-background); box-shadow: var(--shadow);">
                            <i data-lucide="book-open" class="w-8 h-8" style="color: var(--primary);"></i>
                        </div>
                        <span class="font-semibold text-center" style="color: var(--card-foreground);">Наша Продукція</span>
                    </button>
                    <button data-page="contacts-page" class="menu-card group flex flex-col items-center justify-center p-4 rounded-lg transition-transform transform hover:scale-105" style="background-color: var(--secondary-background); box-shadow: var(--shadow-sm);">
                         <div class="p-3 rounded-full mb-3" style="background-color: var(--card-background); box-shadow: var(--shadow);">
                            <i data-lucide="users" class="w-8 h-8" style="color: var(--primary);"></i>
                        </div>
                        <span class="font-semibold text-center" style="color: var(--card-foreground);">Корисні Контакти</span>
                    </button>
                </div>
            </div>

            <!-- Products Page -->
            <div id="products-page" class="sub-page">
                <h3 class="text-xl font-bold mb-4" style="color: var(--card-foreground);">Каталог продукції</h3>
                <p class="text-sm mb-4" style="color: var(--muted-foreground);">Ознайомтеся з асортиментом бренду «Галя Балувана».</p>
                <div id="products-loading" class="hidden text-sm text-center mb-4" style="color: var(--muted-foreground);">Каталог завантажується...</div>
                <div id="products-error" class="hidden text-sm text-center mb-4 font-medium" style="color: #dc2626;"></div>
                <div id="products-container" class="grid grid-cols-1 gap-4 sm:grid-cols-2"></div>
            </div>
            
            <!-- Standards Page (Knowledge Base) -->
            <div id="standards-page" class="sub-page">
                <h3 class="text-xl font-bold mb-4">База Знань</h3>
                <div class="space-y-2">
                    <div class="border rounded-lg" style="border-color: var(--border);">
                        <button class="accordion-toggle w-full flex justify-between items-center p-4 text-left font-semibold">
                            <span>Вхід до каси Poster</span>
                            <i data-lucide="chevron-down" class="w-5 h-5 transition-transform duration-300"></i>
                        </button>
                        <div class="accordion-content">
                             <div class="p-4 pt-0" style="color: var(--muted-foreground);">
                                <ul class="list-disc pl-5 space-y-2">
                                    <li>Кожен продавець має унікальний логін та пароль.</li>
                                    <li>Вхід здійснюється за посиланням <strong>[заклад].joinposter.com</strong>.</li>
                                    <li>Після вводу логіну/паролю необхідно ввести персональний ПІН-код.</li>
                                    <li>Детальніше — в <a href="https://knowledge-base.joinposter.com/uk-ua/log-in-to-pos-register" target="_blank" class="hover:underline" style="color: var(--primary);">інструкції Poster</a>.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="border rounded-lg" style="border-color: var(--border);">
                        <button class="accordion-toggle w-full flex justify-between items-center p-4 text-left font-semibold">
                            <span>Основні операції на касі Poster</span>
                            <i data-lucide="chevron-down" class="w-5 h-5 transition-transform duration-300"></i>
                        </button>
                        <div class="accordion-content">
                            <div class="p-4 pt-0" style="color: var(--muted-foreground);">
                                <ul class="list-disc pl-5 space-y-2">
                                    <li><b>Додавання товару:</b> пошук за назвою, вибір з категорії, сканування штрих-коду.</li>
                                    <li><b>Сортування товарів:</b> налаштуйте вигляд меню за популярністю чи алфавітом для швидкої роботи.</li>
                                    <li><b>Редагування чека:</b> зміна кількості, додавання коментарів до страв.</li>
                                    <li><b>Прийом оплати:</b> готівка, картка, змішана оплата (split-payment).</li>
                                    <li><b>Робота з чеком:</b> друк, відправка на email, перегляд історії.</li>
                                    <li>Детальніше — в <a href="https://knowledge-base.joinposter.com/uk-ua/how-to-work-with-pos" target="_blank" class="hover:underline" style="color: var(--primary);">Базі знань Poster</a> та <a href="https://knowledge-base.joinposter.com/uk-ua/how-to-sort-products-on-the-register" target="_blank" class="hover:underline" style="color: var(--primary);">інструкції з сортування</a>.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                     <div class="border rounded-lg" style="border-color: var(--border);">
                        <button class="accordion-toggle w-full flex justify-between items-center p-4 text-left font-semibold">
                            <span>Звіти на касі (X та Z-звіти)</span>
                            <i data-lucide="chevron-down" class="w-5 h-5 transition-transform duration-300"></i>
                        </button>
                        <div class="accordion-content">
                             <div class="p-4 pt-0" style="color: var(--muted-foreground);">
                                <ul class="list-disc pl-5 space-y-2">
                                    <li><b>X-звіт:</b> показує поточну суму готівки в касі. Використовується для проміжної звірки протягом дня.</li>
                                    <li><b>Z-звіт:</b> фіскальний звіт, який закриває зміну та надсилає дані до податкової. Формується один раз в кінці зміни.</li>
                                    <li>Детальніше — в <a href="https://knowledge-base.joinposter.com/uk-ua/how-to-generate-x-and-z-reports" target="_blank" class="hover:underline" style="color: var(--primary);">інструкції Poster</a>.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="border rounded-lg" style="border-color: var(--border);">
                        <button class="accordion-toggle w-full flex justify-between items-center p-4 text-left font-semibold">
                            <span>Службові транзакції (внесення/видача)</span>
                            <i data-lucide="chevron-down" class="w-5 h-5 transition-transform duration-300"></i>
                        </button>
                        <div class="accordion-content">
                            <div class="p-4 pt-0" style="color: var(--muted-foreground);">
                                <ul class="list-disc pl-5 space-y-2">
                                    <li><b>Службове внесення:</b> використовується для додавання грошей в касу, не пов'язаних з продажем (напр., розмін).</li>
                                    <li><b>Службова видача:</b> для видачі грошей з каси на операційні витрати (напр., оплата кур'єру).</li>
                                    <li>Всі транзакції фіксуються для точного обліку готівки.</li>
                                    <li>Детальніше — в <a href="https://knowledge-base.joinposter.com/uk-ua/how-to-add-a-transaction-on-the-register" target="_blank" class="hover:underline" style="color: var(--primary);">інструкції Poster</a>.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="border rounded-lg" style="border-color: var(--border);">
                        <button class="accordion-toggle w-full flex justify-between items-center p-4 text-left font-semibold">
                            <span>Робота з ПРРО 2.0 (Фіскалізація)</span>
                            <i data-lucide="chevron-down" class="w-5 h-5 transition-transform duration-300"></i>
                        </button>
                        <div class="accordion-content">
                            <div class="p-4 pt-0" style="color: var(--muted-foreground);">
                                <ul class="list-disc pl-5 space-y-2">
                                    <li><b>ПРРО</b> — це програмний реєстратор, він замінює класичний касовий апарат.</li>
                                    <li>Кожен чек автоматично відправляється до податкової (ДПС).</li>
                                    <li><b>Електронний чек:</b> замість друку можна показати клієнту QR-код для сканування або відправити чек на email.</li>
                                    <li><b>Z-звіт</b> є обов'язковим для закриття зміни та передачі фіскальних даних.</li>
                                    <li>ПРРО може працювати в <b>офлайн-режимі</b> (без інтернету) до 36 годин поспіль.</li>
                                    <li>Детальніше — в <a href="https://knowledge-base.joinposter.com/uk-ua/how-to-work-with-pro-2.0-at-the-cashier" target="_blank" class="hover:underline" style="color: var(--primary);">інструкції по ПРРО</a> та <a href="https://knowledge-base.joinposter.com/uk-ua/how-to-fiscalize-receipts-without-printing" target="_blank" class="hover:underline" style="color: var(--primary);">про електронні чеки</a>.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                     <div class="border rounded-lg" style="border-color: var(--border);">
                        <button class="accordion-toggle w-full flex justify-between items-center p-4 text-left font-semibold">
                            <span>Робота з поверненнями та конфліктами</span>
                            <i data-lucide="chevron-down" class="w-5 h-5 transition-transform duration-300"></i>
                        </button>
                        <div class="accordion-content">
                            <div class="p-4 pt-0" style="color: var(--muted-foreground);">
                                <ul class="list-disc pl-5 space-y-2">
                                     <li><b>Продукти харчування:</b> якщо якість належна, поверненню/обміну не підлягають (Постанова КМУ). Якщо є дефект — оформлюємо повернення.</li>
                                     <li><b>Непродовольчі товари:</b> 14 днів на повернення, якщо товар не був у використанні та збережено його вигляд.</li>
                                     <li><b>Немає паперового чека:</b> не є причиною для відмови. Доказом є ел. чек, QR, виписка з банку, камери.</li>
                                     <li><b>Алгоритм LEARN:</b> Listen (Вислухай) → Empathize (Поспівчувай) → Ask (Уточни) → Resolve (Виріши) → Next step (Наступний крок).</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="border rounded-lg" style="border-color: var(--border);">
                        <button class="accordion-toggle w-full flex justify-between items-center p-4 text-left font-semibold">
                            <span>Сервіс-скрипти</span>
                            <i data-lucide="chevron-down" class="w-5 h-5 transition-transform duration-300"></i>
                        </button>
                        <div class="accordion-content">
                            <div class="p-4 pt-0" style="color: var(--muted-foreground);">
                                <ul class="list-disc pl-5 space-y-2">
                                    <li><b>Привітання:</b> "Доброго дня! Вітаємо в 'Галя Балувана'!"</li>
                                    <li><b>Уточнення потреби:</b> "Що сьогодні смачненького шукаєте?"</li>
                                    <li><b>Ап-сел/Крос-сел:</b> "До пельменів чудово пасує наш фірмовий соус. Спробуєте?"</li>
                                    <li><b>Робота зі скаргою:</b> "Дуже шкода, що так сталося. Давайте разом вирішимо цю ситуацію."</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Adaptation Plan Page -->
            <div id="plan-page" class="sub-page">
                <h3 class="text-xl font-bold mb-4">План Навчання Продавця (6 Днів)</h3>
                <div id="plan-container" class="space-y-2">
                    <!-- Days will be generated here by JS -->
                </div>
            </div>
            
            <!-- Checklists Page -->
            <div id="checklists-page" class="sub-page">
                <h3 class="text-xl font-bold mb-4">Щоденні Чек-листи</h3>
                <div class="space-y-2">
                    <div class="border rounded-lg" style="border-color: var(--border);">
                        <button class="accordion-toggle w-full flex justify-between items-center p-4 text-left font-semibold">
                            <span>A. Відкриття зміни в Poster</span>
                            <i data-lucide="chevron-down" class="w-5 h-5 transition-transform duration-300"></i>
                        </button>
                        <div class="accordion-content">
                            <div class="p-4 pt-0" style="color: var(--muted-foreground);">
                                <ul class="list-decimal pl-5 space-y-2">
                                    <li>Відкрити касу за посиланням <code>[заклад].joinposter.com</code>.</li>
                                    <li>Ввести <strong>логін</strong> та <strong>пароль</strong>.</li>
                                    <li>Ввести <strong>ПІН-код</strong>.</li>
                                    <li>Вказати суму готівки в касі (розмін).</li>
                                    <li>Натиснути «Відкрити зміну».</li>
                                    <li>Перевірити стан принтера та чекової стрічки.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="border rounded-lg" style="border-color: var(--border);">
                        <button class="accordion-toggle w-full flex justify-between items-center p-4 text-left font-semibold">
                            <span>B. Закриття зміни + Z-звіт</span>
                            <i data-lucide="chevron-down" class="w-5 h-5 transition-transform duration-300"></i>
                        </button>
                        <div class="accordion-content">
                            <div class="p-4 pt-0" style="color: var(--muted-foreground);">
                                <ul class="list-decimal pl-5 space-y-2">
                                    <li>У кінці робочого дня в меню каси обрати «Касові зміни».</li>
                                    <li>Перевірити суму готівки в касі, порівнявши її з X-звітом.</li>
                                    <li>Натиснути «Закрити зміну» та сформувати Z-звіт (фіскальний звіт) через ПРРО.</li>
                                    <li>Передати готівку та зміну наступному продавцю.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="border rounded-lg" style="border-color: var(--border);">
                        <button class="accordion-toggle w-full flex justify-between items-center p-4 text-left font-semibold">
                            <span>C. FIFO на полиці/вітрині</span>
                            <i data-lucide="chevron-down" class="w-5 h-5 transition-transform duration-300"></i>
                        </button>
                        <div class="accordion-content">
                            <div class="p-4 pt-0" style="color: var(--muted-foreground);">
                                <ul class="list-disc pl-5 space-y-2">
                                    <li>Нове «в глиб», старіше — «на фасад».</li>
                                    <li>Перевірка дат «краще вжити до» щозміни.</li>
                                    <li>Ротація при кожній поставці.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                     <div class="border rounded-lg" style="border-color: var(--border);">
                        <button class="accordion-toggle w-full flex justify-between items-center p-4 text-left font-semibold">
                            <span>D. HACCP мінімум для продавця</span>
                            <i data-lucide="chevron-down" class="w-5 h-5 transition-transform duration-300"></i>
                        </button>
                        <div class="accordion-content">
                             <div class="p-4 pt-0" style="color: var(--muted-foreground);">
                                <ul class="list-disc pl-5 space-y-2">
                                    <li>Особиста гігієна, чисті руки, рукавички за потреби.</li>
                                    <li>Контроль температур (холод ≤ 5°C, гаряче ≥ 63°C).</li>
                                    <li>Уникати перехресного забруднення (сире/готове).</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quiz Page -->
            <div id="quiz-page" class="sub-page">
                <h3 class="text-xl font-bold mb-4">Перевірка Знань</h3>
                <div id="quiz-container">
                    <div id="quiz-start" class="text-center">
                        <div id="quiz-menu" class="space-y-3">
                           <!-- Quiz buttons will be generated here -->
                        </div>
                    </div>
                    
                    <div id="quiz-main" class="hidden">
                         <div class="mb-6 text-center">
                             <i data-lucide="graduation-cap" class="w-16 h-16 mx-auto mb-4" style="color: var(--primary);"></i>
                             <h4 id="quiz-title" class="text-lg font-semibold mb-2"></h4>
                             <p id="quiz-description" style="color: var(--muted-foreground);"></p>
                         </div>
                        <div id="quiz-questions" class="hidden">
                            <div class="mb-4">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-sm" style="color: var(--muted-foreground);">Питання <span id="current-question">1</span> з <span id="total-questions">7</span></span>
                                    <span class="text-sm" style="color: var(--muted-foreground);">Бали: <span id="current-score">0</span></span>
                                </div>
                                <div class="w-full rounded-full h-2" style="background-color: var(--secondary-background);">
                                    <div id="progress-bar" class="h-2 rounded-full transition-all duration-300" style="background-color: var(--primary); width: 0%"></div>
                                </div>
                            </div>
                            
                            <div id="question-container" class="mb-6">
                                <h4 id="question-text" class="text-lg font-semibold mb-4"></h4>
                                <div id="answers-container" class="space-y-3"></div>
                            </div>
                            
                            <div class="flex justify-between">
                                 <button id="prev-question" class="px-4 py-2 rounded-lg transition-colors hidden" style="background-color: var(--secondary-background); color: var(--foreground);">
                                    Попереднє
                                </button>
                                <button id="next-question" class="px-6 py-2 rounded-lg transition-colors" style="background-color: var(--primary); color: var(--primary-foreground);">
                                    Наступне
                                </button>
                            </div>
                        </div>
                        
                        <div id="quiz-results" class="hidden text-center">
                            <div class="mb-6">
                                <i data-lucide="trophy" class="w-16 h-16 mx-auto mb-4" style="color: var(--primary);"></i>
                                <h4 class="text-lg font-semibold mb-2">Тест завершено!</h4>
                                <p style="color: var(--muted-foreground);">Ваш результат: <span id="final-score" class="font-bold" style="color: var(--primary);">0</span> з <span id="max-score">7</span></p>
                                <p id="result-message" class="text-sm mt-2" style="color: var(--muted-foreground);"></p>
                            </div>
                            <button id="restart-quiz" class="w-full px-6 py-3 rounded-lg font-semibold transition-colors" style="background-color: var(--primary); color: var(--primary-foreground);">
                                Пройти знову
                            </button>
                             <button id="back-to-tests" class="w-full mt-2 px-6 py-3 rounded-lg font-semibold transition-colors" style="background-color: var(--secondary-background); color: var(--foreground);">
                                Повернутись до тестів
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Contacts Page -->
            <div id="contacts-page" class="sub-page">
                <h3 class="text-xl font-bold mb-4">Корисні Контакти</h3>
                <div class="space-y-4">
                    <div class="p-4 rounded-lg border" style="background-color: var(--secondary-background); border-color: var(--border);">
                        <div class="flex items-center mb-3">
                            <i data-lucide="user-check" class="w-6 h-6 mr-3" style="color: var(--primary);"></i>
                            <h4 class="font-semibold" style="color: var(--card-foreground);">Ваш наставник</h4>
                        </div>
                        <div class="space-y-2 text-sm" style="color: var(--muted-foreground);">
                            <p><strong>Ім'я:</strong> Марія Іванівна</p>
                            <p><strong>Посада:</strong> Старший кухар</p>
                            <p><strong>Телефон:</strong> <a href="tel:+380501234567" class="hover:underline" style="color: var(--primary);">+38 (050) 123-45-67</a></p>
                        </div>
                    </div>
                    <div class="p-4 rounded-lg border" style="background-color: var(--secondary-background); border-color: var(--border);">
                        <div class="flex items-center mb-3">
                            <i data-lucide="users" class="w-6 h-6 mr-3" style="color: var(--primary);"></i>
                            <h4 class="font-semibold" style="color: var(--card-foreground);">HR відділ</h4>
                        </div>
                        <div class="space-y-2 text-sm" style="color: var(--muted-foreground);">
                            <p><strong>Менеджер:</strong> Олена Петрівна</p>
                            <p><strong>Телефон:</strong> <a href="tel:+380501234568" class="hover:underline" style="color: var(--primary);">+38 (050) 123-45-68</a></p>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        // --- UTILITY FUNCTIONS ---
        function createElement(tag, content, attributes = {}) {
            const element = document.createElement(tag);
            if (content) {
                if (typeof content === 'string') element.textContent = content;
                else element.appendChild(content);
            }
            Object.entries(attributes).forEach(([key, value]) => element.setAttribute(key, value));
            return element;
        }

        // --- APP INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();

            // --- STATE MANAGEMENT ---
            let progressState = {
                theme: 'light',
                completedDays: [] // Stores numbers of completed days, e.g., [1, 2]
            };

            const PASS_THRESHOLD = 0.8; // 80% to pass the test

            const productsContainer = document.getElementById('products-container');
            const productsLoading = document.getElementById('products-loading');
            const productsError = document.getElementById('products-error');

            function createProductCard(product) {
                const card = createElement('article', null, {
                    'class': 'border rounded-lg overflow-hidden flex flex-col shadow-sm',
                    'style': 'border-color: var(--border); background-color: var(--card-background);'
                });

                if (product.image) {
                    const image = createElement('img', null, {
                        src: product.image,
                        alt: product.name || 'Продукт',
                        'class': 'h-40 w-full object-cover'
                    });
                    card.appendChild(image);
                }

                const content = createElement('div', null, { 'class': 'p-4 flex flex-col flex-1' });
                content.appendChild(createElement('h4', product.name || 'Без назви', {
                    'class': 'font-semibold text-base mb-3',
                    'style': 'color: var(--card-foreground);'
                }));

                if (product.url) {
                    content.appendChild(createElement('a', 'Переглянути', {
                        href: product.url,
                        target: '_blank',
                        rel: 'noopener noreferrer',
                        'class': 'mt-auto inline-flex items-center justify-center px-4 py-2 rounded-md font-medium transition-colors',
                        'style': 'background-color: var(--primary); color: var(--primary-foreground);'
                    }));
                }

                card.appendChild(content);
                return card;
            }

            function loadProducts() {
                if (!productsContainer || !productsLoading || !productsError) return;

                productsLoading.classList.remove('hidden');
                productsError.classList.add('hidden');
                productsError.textContent = '';
                productsContainer.innerHTML = '';

                fetch('catalog.json')
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (!Array.isArray(data)) {
                            throw new Error('Invalid catalog format');
                        }

                        if (data.length === 0) {
                            productsContainer.appendChild(createElement('p', 'Каталог наразі порожній.', {
                                'class': 'text-sm text-center',
                                'style': 'color: var(--muted-foreground);'
                            }));
                            return;
                        }

                        const fragment = document.createDocumentFragment();
                        let hasCards = false;

                        data.forEach(product => {
                            if (!product || (!product.name && !product.image && !product.url)) return;
                            fragment.appendChild(createProductCard(product));
                            hasCards = true;
                        });

                        if (!hasCards) {
                            productsContainer.appendChild(createElement('p', 'Каталог наразі недоступний.', {
                                'class': 'text-sm text-center',
                                'style': 'color: var(--muted-foreground);'
                            }));
                            return;
                        }

                        productsContainer.appendChild(fragment);
                    })
                    .catch(error => {
                        console.error('Не вдалося завантажити каталог:', error);
                        productsError.textContent = 'Каталог тимчасово недоступний. Спробуйте оновити сторінку пізніше.';
                        productsError.classList.remove('hidden');
                    })
                    .finally(() => {
                        productsLoading.classList.add('hidden');
                    });
            }

            function saveProgress() {
                localStorage.setItem('traineeProgress', JSON.stringify(progressState));
            }

            function loadProgress() {
                const saved = localStorage.getItem('traineeProgress');
                if (saved) {
                    progressState = JSON.parse(saved);
                }
                applyTheme();
                renderPlan();
                renderQuizMenu();
                updateMainProgressBar();
            }
            
            // --- THEME LOGIC ---
            const themeToggle = document.getElementById('theme-toggle');
            const themeIcon = document.getElementById('theme-icon');
            
            function applyTheme() {
                if (progressState.theme === 'dark') {
                    document.documentElement.classList.add('dark');
                    themeIcon.setAttribute('data-lucide', 'sun');
                } else {
                    document.documentElement.classList.remove('dark');
                    themeIcon.setAttribute('data-lucide', 'moon');
                }
                lucide.createIcons();
            }

            themeToggle.addEventListener('click', () => {
                progressState.theme = progressState.theme === 'light' ? 'dark' : 'light';
                saveProgress();
                applyTheme();
            });

            // --- PAGE NAVIGATION ---
            const mainPage = document.getElementById('main-page');
            const subPages = document.querySelectorAll('.sub-page');
            const menuCards = document.querySelectorAll('.menu-card');
            const backButton = document.getElementById('backButton');
            const headerTitle = document.getElementById('headerTitle');
            
            const pageTitles = {
                'products-page': 'Наша Продукція', 'standards-page': 'База Знань',
                'plan-page': 'План Навчання', 'quiz-page': 'Перевірка Знань',
                'contacts-page': 'Корисні Контакти', 'checklists-page': 'Щоденні Чек-листи'
            };

            const showPage = (pageId) => {
                mainPage.style.display = 'none';
                subPages.forEach(page => page.style.display = 'none');
                const activePage = document.getElementById(pageId);
                if (activePage) {
                    activePage.style.display = 'block';
                    headerTitle.textContent = pageTitles[pageId] || 'Деталі';
                    backButton.classList.remove('invisible');
                }
            };

            const showMainPage = () => {
                subPages.forEach(page => page.style.display = 'none');
                mainPage.style.display = 'block';
                headerTitle.textContent = 'Навігатор Стажера';
                backButton.classList.add('invisible');
            };

            menuCards.forEach(card => card.addEventListener('click', () => showPage(card.dataset.page)));
            backButton.addEventListener('click', showMainPage);
            
            // --- DYNAMIC CONTENT & PROGRESSION ---
            const planContainer = document.getElementById('plan-container');
            const planData = [
                 { day: 1, title: "Знайомство, безпечний старт, тіньове спостереження", content: `<p class="font-semibold mb-2">Цілі дня: відчуття «мене тут чекають», розуміння бренду, як влаштована зміна, базові правила безпеки та сервісу.</p><ul class="list-disc pl-5 space-y-3 mt-2"><li><b>Теплий прийом (30 хв):</b> Вітання команди, історія бренду, план на 5 днів, знайомство з наставником.</li><li><b>Організаційні речі (30 хв):</b> Доступи, форма, графік, тур по магазину (кухні, склад, зони персоналу).</li><li><b>Мікро-безпека (20 хв):</b> Гігієна рук, "небезпечна зона температур" (холод/тепло), розділення сирого/готового.</li><li><b>Poster POS — тільки знайомство (30 хв):</b> Наставник показує інтерфейс, як виглядає чек, де звіти. Без самостійних дій.</li><li><b>Shadowing (Тіньове спостереження, 1-2 год):</b> Спостереження за роботою наставника в залі: діалоги з гостями, робота з вітриною (FIFO), пропозиції допродажу.</li><li><b>Підсумок дня (15 хв):</b> Обговорення з наставником: «Що дізнався? Що здивувало? Що хочеш спробувати завтра?».</li></ul>` },
                { day: 2, title: "«Перші мікродії» (разом із наставником)", content: `<p class="font-semibold mb-2">Цілі: впевнено орієнтуватися в Poster, відкрити зміну, додати позиції, зробити X-звіт, фіксувати транзакції.</p><ul class="list-disc pl-5 space-y-3 mt-2"><li><b>Вхід у POS (20 хв):</b> Логін → PIN → «Залишок у касі» → Відкрити зміну (натискає наставник, стажер коментує).</li><li><b>Продаж (тренувально, 30 хв):</b> Додавання товарів (шт/вага), знижка, оплата, друк чека.</li><li><b>Готівкові транзакції (20 хв):</b> Демонстрація внесення, витрати та інкасації в меню POS.</li><li><b>X-звіт (15 хв):</b> Що показує і чим відрізняється від Z-звіту.</li><li><b>Shadowing та FIFO (1 год):</b> Спостереження за діалогами, практика FIFO на одній полиці.</li></ul>` },
                { day: 3, title: "«Фіскалізація на тренажері» (ПРРО) + Z-звіт", content: `<p class="font-semibold mb-2">Цілі: розуміти фіскалізацію, індикатори чеків, повернення; вміти зняти Z-звіт разом з наставником.</p><ul class="list-disc pl-5 space-y-3 mt-2"><li><b>Теорія X vs Z (20 хв):</b> X — проміжний, для себе; Z — фінальний, для податкової.</li><li><b>ПРРО на касі (демо, 30 хв):</b> Де вмикається фіскалізація, індикатори успіху/помилки.</li><li><b>Сценарії (40 хв):</b> Продаж (готівка/картка) з фіскальним чеком; повернення фіскального чека.</li><li><b>Інкасація (20 хв):</b> Як оформити переведення виручки в сейф.</li><li><b>Z-звіт «разом» (30 хв):</b> X-звіт → звірка готівки → інкасація → «Закрити зміну» з Z-звітом.</li></ul>` },
                { day: 4, title: "Клієнт, конфлікти, повернення/обміни", content: `<p class="font-semibold mb-2">Цілі: дати продавцю чітку рамку поведінки у складних діалогах; розібрати повернення/обмін згідно закону.</p><ul class="list-disc pl-5 space-y-3 mt-2"><li><b>Юридичні рамки (30 хв):</b> Коли можна і не можна повертати харчові товари. Що робити, якщо немає паперового чека.</li><li><b>Алгоритм деескалації LEARN (30 хв):</b> Listen (Вислухай) → Empathize (Поспівчувай) → Ask (Уточни) → Resolve (Виріши) → Next step (Наступний крок).</li><li><b>Рольові ігри-сценарії (45 хв)</b></li></ul>` },
                { day: 5, title: "Знання товару, асортимент, алергени", content: `<p class="font-semibold mb-2">Цілі: розуміти категорії; вміти читати упаковку (термін, алергени), давати рекомендації, знижувати списання.</p><ul class="list-disc pl-5 space-y-3 mt-2"><li><b>Карта асортименту:</b> Чим відрізняються продукти всередині категорії (смаки, формати). Які позиції є "хітами".</li><li><b>Читання етикетки (Закон України):</b> Де шукати склад, термін придатності, умови зберігання та виділені <b>алергени</b>.</li><li><b>Практика - "Полка-кейс" (15 хв):</b> Привести одну полицю до ідеального FIFO.</li></ul>` },
                { day: 6, title: "«Залік-лайт» та готовність до зміни", content: `<p class="font-semibold mb-2">Цілі: довести стабільність роботи (каса, сервіс, FIFO/HACCP); отримати допуск до самостійної зміни.</p><ul class="list-disc pl-5 space-y-3 mt-2"><li><b>Практичний залік (1 год, без підказок)</b></li><li><b>ПРРО-кейс (25 хв, тренувально)</b></li><li><b>Сервіс-залік (20 хв)</b></li></ul>` }
            ];

            function renderPlan() {
                planContainer.innerHTML = '';
                planData.forEach((dayData, index) => {
                    const day = index + 1;
                    const isLocked = day > progressState.completedDays.length + 1;
                    const isCompleted = progressState.completedDays.includes(day);

                    const container = createElement('div', null, {'class': 'border rounded-lg', 'style': 'border-color: var(--border);'});
                    const button = createElement('button', null, {
                        'class': 'accordion-toggle w-full flex justify-between items-center p-4 text-left font-semibold'
                    });
                    if(isLocked) {
                        button.disabled = true;
                        button.classList.add('opacity-50', 'cursor-not-allowed');
                    }

                    const titleSpan = createElement('span', `День ${day}: ${dayData.title}`);
                    const iconContainer = createElement('span', null, {
                        'class': 'flex items-center ml-2',
                        'style': 'gap: 0.5rem;'
                    });

                    if (isCompleted || isLocked) {
                        const statusIconName = isLocked ? 'lock' : 'check-circle-2';
                        const statusIcon = createElement('i', null, {
                            'data-lucide': statusIconName,
                            'class': 'w-5 h-5 flex-shrink-0'
                        });
                        if (isCompleted) statusIcon.style.color = 'var(--success)';
                        if (isLocked) statusIcon.style.color = 'var(--muted-foreground)';
                        iconContainer.appendChild(statusIcon);
                    }

                    const chevronIcon = createElement('i', null, {
                        'data-lucide': 'chevron-down',
                        'class': 'w-5 h-5 transition-transform duration-300 flex-shrink-0'
                    });
                    iconContainer.appendChild(chevronIcon);

                    button.append(titleSpan, iconContainer);

                    const contentWrapper = createElement('div', null, {'class': 'accordion-content'});
                    const contentDiv = createElement('div', null, {'class': 'p-4 pt-0', 'style': 'color: var(--muted-foreground);'});
                    contentDiv.innerHTML = dayData.content;
                    contentWrapper.appendChild(contentDiv);
                    
                    container.append(button, contentWrapper);
                    planContainer.appendChild(container);
                });
                lucide.createIcons();
            }
            
            function updateUnlockedContent() {
                renderPlan();
                renderQuizMenu();
            }

            function updateMainProgressBar() {
                const totalDays = planData.length;
                const baseProgress = 5;
                const progressPerDay = (100 - baseProgress) / totalDays;
                const calculatedProgress = baseProgress + (progressState.completedDays.length * progressPerDay);
                const newProgress = Math.min(100, calculatedProgress);

                const progressBar = document.getElementById('mainProgressBar');
                const progressText = document.getElementById('mainProgressText');
                
                progressBar.style.width = `${newProgress}%`;
                progressText.textContent = `${Math.round(newProgress)}%`;
            }

            // --- ACCORDION LOGIC ---
            function handleAccordionToggle(toggle) {
                if(!toggle || toggle.disabled) return;
                const content = toggle.nextElementSibling;
                const icon = toggle.querySelector('[data-lucide="chevron-down"]');
                if (!icon) return; // Don't toggle for lock/check icons
                
                const isCurrentlyOpen = content.style.maxHeight && content.style.maxHeight !== "0px";
                const parent = toggle.closest('.space-y-2');
                if (parent) {
                    parent.querySelectorAll('.accordion-content').forEach(el => {
                        if(el !== content) {
                           el.style.maxHeight = null;
                           const otherIcon = el.previousElementSibling.querySelector('[data-lucide="chevron-down"]');
                           if (otherIcon) otherIcon.classList.remove('rotate-180');
                        }
                    });
                }
                
                if (!isCurrentlyOpen) {
                    content.style.maxHeight = content.scrollHeight + "px";
                    icon.classList.add('rotate-180');
                } else {
                    content.style.maxHeight = null;
                    icon.classList.remove('rotate-180');
                }
            }
            
            planContainer.addEventListener('click', (e) => handleAccordionToggle(e.target.closest('.accordion-toggle')));
            document.querySelector('#standards-page').addEventListener('click', (e) => handleAccordionToggle(e.target.closest('.accordion-toggle')));
            document.querySelector('#checklists-page').addEventListener('click', (e) => handleAccordionToggle(e.target.closest('.accordion-toggle')));


            // --- QUIZ DATA & LOGIC ---
            const allQuizzes = {
                day1: { title: "Тест: День 1", description: "Знайомство та орієнтація", questions: [
                    { question: "Що робить buddy/наставник у перший тиждень?", answers: ["Контролює касу замість вас", "Супроводжує, відповідає на питання, дає мікрозавдання", "Оцінює лише штрафи"], correct: 1 },
                    { question: "Де в Poster на касі дивитись X/Z-звіт?", answers: ["В головному меню POS/касові зміни", "Лише в адмін-панелі", "Ніде"], correct: 0 },
                    { question: "«Небезпечна температурна зона» для їжі — це приблизно:", answers: ["5–60 °C", "0–20 °C", "60–90 °C"], correct: 0 },
                ]},
                day2: { title: "Тест: День 2", description: "Перші дії в POS", questions: [
                    { question: "Порядок старту зміни: логін → PIN → ... → «Відкрити». Який крок пропущено?", answers: ["Ввести «Залишок у касі»", "Зробити X-звіт", "Перевірити пошту"], correct: 0 },
                    { question: "X-звіт — це:", answers: ["Перевірка стану продажів у середині зміни (не відправляється в ДПС)", "Фінальний звіт для податкової", "Звіт по залишках на складі"], correct: 0 }
                ]},
                day3: { title: "Тест: День 3", description: "ПРРО та Фіскалізація", questions: [
                    { question: "Z-звіт — це...", answers: ["Добовий підсумок зміни, який відправляється в ДПС", "Звіт, який можна робити багато разів на день", "Звіт про популярні товари"], correct: 0 },
                    { question: "Чим X-звіт відрізняється від Z-звіту?", answers: ["Не відправляється на фіскальний сервер і служить для внутрішнього контролю", "Нічим, це одне й те саме", "X-звіт містить більше даних"], correct: 0 },
                ]},
                day4: { title: "Тест: День 4", description: "Клієнтський сервіс", questions: [
                    { question: "Чи можна відмовити у поверненні товару, якщо у клієнта немає паперового чека?", answers: ["Так, без паперового чека повернення неможливе", "Ні, якщо є інші докази покупки", "Тільки за дозволом директора"], correct: 1 },
                    { question: "Що є першим кроком в алгоритмі деескалації конфлікту LEARN?", answers: ["L - Listen (Вислухати клієнта)", "E - Empathize (Поспівчувай)", "A - Ask (Поставити питання)"], correct: 0 }
                ]},
                day5: { title: "Тест: День 5", description: "Знання Товару", questions: [
                    { question: "Що обов'язково має бути на харчовій етикетці?", answers: ["Тільки назва", "Назва + ціна", "Назва, склад, виділені алергени, умови зберігання"], correct: 2 },
                    { question: "«Небезпечна зона температур» для продуктів:", answers: ["0–20 °C", "≈5–60 °C", "70–100 °C"], correct: 1 }
                ]},
                day6: { title: "Тест: День 6", description: "Залік та готовність до зміни", questions: [
                    { question: "Яка головна мета практичного \"Заліку-лайт\" шостого дня?", answers: ["Перевірити лише теоретичні знання", "Підтвердити стабільну роботу з касою, сервісом та HACCP", "Вивчити нові товари"], correct: 1 },
                    { question: "Що демонструє стажер перед допуском до самостійної зміни?", answers: ["Стійке володіння касою, сервісними сценаріями та дотримання FIFO/HACCP", "Лише швидкість пробиття чеків", "Тільки знання законодавства"], correct: 0 },
                    { question: "Що робити після успішного проходження шостого дня?", answers: ["Одразу закрити зміну без фіскалізації", "Залишити прогрес без змін", "Перейти до самостійної роботи, маючи підтвердження наставника"], correct: 2 }
                ]}
            };

            let currentQuizKey = '';
            let currentQuizData = []; let currentQuestion = 0; let score = 0; let userAnswers = [];
            const quizMenu = document.getElementById('quiz-menu'); const quizStartScreen = document.getElementById('quiz-start');
            const quizMainScreen = document.getElementById('quiz-main');

            function renderQuizMenu() {
                quizMenu.innerHTML = '';
                Object.keys(allQuizzes).forEach(quizId => {
                    const day = parseInt(quizId.replace('day', ''));
                    const isLocked = day > progressState.completedDays.length + 1;
                    const isCompleted = progressState.completedDays.includes(day);

                    const quizInfo = allQuizzes[quizId];
                    const button = createElement('button', null, {
                        'data-quiz-id': quizId,
                        'class': 'w-full text-left p-4 rounded-lg font-semibold transition-colors flex justify-between items-center'
                    });

                    button.disabled = isLocked;
                    
                    const textDiv = createElement('div');
                    const title = createElement('span', quizInfo.title, {'class': 'block text-lg'});
                    const description = createElement('span', quizInfo.description, {'class': 'block text-sm opacity-80 mt-1'});
                    textDiv.append(title, description);

                    const icon = createElement('i', null, {'class': 'w-6 h-6 flex-shrink-0 ml-4'});

                    if(isLocked) {
                        button.classList.add('opacity-50', 'cursor-not-allowed');
                        button.style.backgroundColor = 'var(--secondary-background)';
                        icon.setAttribute('data-lucide', 'lock');
                    } else if (isCompleted) {
                        button.style.backgroundColor = 'var(--secondary-background)';
                        icon.setAttribute('data-lucide', 'check-circle-2');
                        icon.style.color = 'var(--success)';
                    } else {
                        button.style.backgroundColor = 'var(--primary)';
                        button.style.color = 'var(--primary-foreground)';
                        icon.setAttribute('data-lucide', 'play-circle');
                    }
                    
                    button.append(textDiv, icon);
                    quizMenu.appendChild(button);
                });
                lucide.createIcons();
            }

            function startQuiz(quizId) {
                currentQuizKey = quizId;
                currentQuizData = allQuizzes[quizId].questions;
                document.getElementById('quiz-title').textContent = allQuizzes[quizId].title;
                document.getElementById('quiz-description').textContent = allQuizzes[quizId].description;
                
                quizStartScreen.classList.add('hidden');
                quizMainScreen.classList.remove('hidden');
                document.getElementById('quiz-questions').classList.remove('hidden');
                document.getElementById('quiz-results').classList.add('hidden');
                restartQuizState();
                showQuestion();
            }

            quizMenu.addEventListener('click', (e) => {
                const button = e.target.closest('button');
                if (button && button.dataset.quizId && !button.disabled) startQuiz(button.dataset.quizId);
            });
            
            function showQuestion() {
                const question = currentQuizData[currentQuestion];
                document.getElementById('question-text').textContent = question.question;
                document.getElementById('current-question').textContent = currentQuestion + 1;
                document.getElementById('total-questions').textContent = currentQuizData.length;
                document.getElementById('progress-bar').style.width = ((currentQuestion + 1) / currentQuizData.length) * 100 + '%';
                
                const answersContainer = document.getElementById('answers-container');
                answersContainer.innerHTML = '';
                question.answers.forEach((answer, index) => {
                    const answerDiv = createElement('div', null, { 'class': 'answer-option flex items-center p-3 rounded-lg cursor-pointer', 'style': 'border-color: var(--border);', 'data-answer': index });
                    const radio = createElement('input', null, { type: 'radio', name: 'answer', value: index, class: 'mr-3 h-4 w-4' });
                    const label = createElement('span', answer, { class: 'flex-1' });
                    answerDiv.append(radio, label);
                    answersContainer.appendChild(answerDiv);
                    answerDiv.addEventListener('click', () => {
                        radio.checked = true;
                        userAnswers[currentQuestion] = index;
                        document.querySelectorAll('.answer-option').forEach(el => { el.style.borderColor = 'var(--border)'; el.style.backgroundColor = 'transparent' });
                        answerDiv.style.borderColor = 'var(--primary)';
                        answerDiv.style.backgroundColor = 'var(--secondary-background)';
                        updateCurrentScore();
                    });
                });

                const prevAnswer = userAnswers[currentQuestion];
                if (prevAnswer !== undefined && prevAnswer !== null) {
                    const answerElement = answersContainer.children[prevAnswer];
                    if (answerElement) {
                        answerElement.querySelector('input').checked = true;
                        answerElement.style.borderColor = 'var(--primary)';
                        answerElement.style.backgroundColor = 'var(--secondary-background)';
                    }
                }
                updateCurrentScore(); updateNavigationButtons();
            }
            
            function updateCurrentScore() {
                 score = 0;
                 userAnswers.forEach((answer, index) => { if (answer === currentQuizData[index].correct) score++; });
                document.getElementById('current-score').textContent = score;
            }

            function nextQuestion() {
                const selectedAnswer = document.querySelector('input[name="answer"]:checked');
                if (selectedAnswer) userAnswers[currentQuestion] = parseInt(selectedAnswer.value);
                else userAnswers[currentQuestion] = undefined;
                updateCurrentScore();
                if (currentQuestion < currentQuizData.length - 1) { currentQuestion++; showQuestion(); } 
                else showResults();
            }
            
            function prevQuestion() {
                const selectedAnswer = document.querySelector('input[name="answer"]:checked');
                if (selectedAnswer) userAnswers[currentQuestion] = parseInt(selectedAnswer.value);
                updateCurrentScore();
                if(currentQuestion > 0) { currentQuestion--; showQuestion(); }
            }

            function updateNavigationButtons() {
                document.getElementById('prev-question').classList.toggle('hidden', currentQuestion === 0);
                document.getElementById('next-question').textContent = (currentQuestion === currentQuizData.length - 1) ? 'Завершити тест' : 'Наступне';
            }

            function showResults() {
                updateCurrentScore();
                document.getElementById('quiz-questions').classList.add('hidden');
                document.getElementById('quiz-results').classList.remove('hidden');
                document.getElementById('progress-bar').style.width = '100%';
                document.getElementById('final-score').textContent = score;
                document.getElementById('max-score').textContent = currentQuizData.length;
                const resultMessage = document.getElementById('result-message');
                const percentage = (score / currentQuizData.length);
                
                if (percentage >= PASS_THRESHOLD) {
                    resultMessage.textContent = 'Відмінно! Ви добре знаєте матеріал. Наступний день розблоковано.';
                    const dayNumber = parseInt(currentQuizKey.replace('day', ''));
                    if (!progressState.completedDays.includes(dayNumber)) {
                        progressState.completedDays.push(dayNumber);
                        saveProgress();
                        updateUnlockedContent();
                        updateMainProgressBar();
                    }
                } else {
                    resultMessage.textContent = 'Потрібно більше вивчити матеріал. Рекомендуємо пройти тест знову.';
                }
            }

            function restartQuizState() { currentQuestion = 0; score = 0; userAnswers = []; }
            function showTestMenu() { quizStartScreen.classList.remove('hidden'); quizMainScreen.classList.add('hidden'); }

            document.getElementById('back-to-tests').addEventListener('click', showTestMenu);
            document.getElementById('restart-quiz').addEventListener('click', () => {
                 document.getElementById('quiz-questions').classList.remove('hidden');
                 document.getElementById('quiz-results').classList.add('hidden');
                 restartQuizState();
                 showQuestion();
            });

            // Initial Load
            loadProducts();
            loadProgress();
        });
    </script>
</body>
</html>

