<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–Ü–¥–µ–∞–ª—å–Ω–∏–π –ü—Ä–æ–¥–∞–≤–µ—Ü—å 2.0</title>
    <meta name="theme-color" content="#111827" media="(prefers-color-scheme: dark)">
    <meta name="theme-color" content="#f3f4f6" media="(prefers-color-scheme: light)">
    <style>
        :root {
            --background: #f3f4f6;
            --foreground: #111827;
            --card: #ffffff;
            --muted: #6b7280;
            --border: #e5e7eb;
            --primary: #f97316;
            --primary-foreground: #0f172a;
            --accent: #111827;
            --shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 10px 10px -5px rgb(0 0 0 / 0.04);
            --radius-lg: 1.25rem;
        }

        html.dark {
            --background: #111827;
            --foreground: #f9fafb;
            --card: #1f2937;
            --muted: #9ca3af;
            --border: #374151;
            --primary: #f59e0b;
            --primary-foreground: #111827;
            --accent: #f9fafb;
            --shadow: 0 15px 30px -10px rgb(249 250 251 / 0.15);
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            min-height: 100vh;
            font-family: "Inter", "SF Pro Display", "Segoe UI", system-ui, sans-serif;
            background-color: var(--background);
            color: var(--foreground);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        @supports (padding: max(0px)) {
            body {
                padding-top: max(env(safe-area-inset-top), 0px);
                padding-bottom: max(env(safe-area-inset-bottom), 0px);
            }
        }

        html[data-platform="ios"] body {
            font-family: "SF Pro Text", "SF Pro Display", "Inter", system-ui, sans-serif;
            -webkit-font-smoothing: antialiased;
        }

        html[data-platform="android"] body {
            font-family: "Roboto", "Inter", "Segoe UI", system-ui, sans-serif;
        }

        html[data-platform="windows"] body {
            font-family: "Segoe UI", "Inter", system-ui, sans-serif;
            -webkit-font-smoothing: antialiased;
        }

        html[data-platform="mac"] body {
            font-family: "SF Pro Display", "Inter", system-ui, sans-serif;
            -webkit-font-smoothing: antialiased;
        }

        .app-shell {
            max-width: 720px;
            margin: 0 auto;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background-color: var(--card);
            box-shadow: var(--shadow);
        }

        header {
            position: sticky;
            top: 0;
            z-index: 20;
            backdrop-filter: blur(12px);
            background-color: color-mix(in srgb, var(--card) 90%, transparent);
            border-bottom: 1px solid var(--border);
        }

        .header-inner {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.875rem 1.25rem;
        }

        .header-group {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .icon-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 999px;
            border: 1px solid transparent;
            background: color-mix(in srgb, var(--primary) 12%, transparent);
            color: var(--foreground);
            transition: background-color 0.2s ease, transform 0.2s ease;
        }

        .icon-button:hover {
            background: color-mix(in srgb, var(--primary) 18%, transparent);
            transform: translateY(-1px);
        }

        .icon-button:disabled {
            opacity: 0;
            pointer-events: none;
        }

        main {
            flex: 1;
            padding: 1.5rem 1.25rem 2.5rem;
        }

        .page {
            display: none;
            animation: fade-in 0.25s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fade-in {
            from { opacity: 0; transform: translateY(6px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1, h2, h3, h4 {
            margin: 0;
        }

        .welcome-card {
            text-align: center;
            margin-bottom: 1.75rem;
        }

        .welcome-card strong {
            display: block;
            font-size: 1.75rem;
            margin-bottom: 0.35rem;
        }

        .welcome-card span {
            color: var(--muted);
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 1rem;
        }

        .menu-card {
            position: relative;
            padding: 1.25rem 1rem;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border);
            background: color-mix(in srgb, var(--card) 80%, var(--primary) 3%);
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            cursor: pointer;
        }

        .menu-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 20px -10px rgb(0 0 0 / 0.2);
        }

        .menu-icon {
            width: 52px;
            height: 52px;
            border-radius: 18px;
            background: color-mix(in srgb, var(--primary) 14%, transparent);
            display: grid;
            place-items: center;
            font-size: 1.35rem;
        }

        .section-title {
            font-size: 1.35rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
        }

        .card {
            border: 1px solid var(--border);
            border-radius: 1rem;
            padding: 1.25rem;
            background: color-mix(in srgb, var(--card) 90%, transparent);
            margin-bottom: 1rem;
        }

        details {
            border: 1px solid var(--border);
            border-radius: 1rem;
            padding: 1rem 1.25rem;
            background: color-mix(in srgb, var(--card) 85%, transparent);
        }

        details + details {
            margin-top: 0.75rem;
        }

        summary {
            font-weight: 600;
            cursor: pointer;
            list-style: none;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
        }

        summary::-webkit-details-marker {
            display: none;
        }

        summary::after {
            content: "‚åÑ";
            font-size: 1.1rem;
            transition: transform 0.2s ease;
        }

        details[open] summary::after {
            transform: rotate(180deg);
        }

        details ul,
        details ol {
            margin: 0.85rem 0 0;
            padding-left: 1.1rem;
            color: var(--muted);
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            background: color-mix(in srgb, var(--primary) 14%, transparent);
            border-radius: 999px;
            padding: 0.3rem 0.8rem;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--accent);
        }

        .persona-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .persona-card {
            border: 1px solid var(--border);
            border-radius: 1rem;
            padding: 1.1rem;
            background: color-mix(in srgb, var(--card) 90%, transparent);
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            cursor: pointer;
            transition: transform 0.2s ease, border-color 0.2s ease;
        }

        .persona-card:hover {
            transform: translateY(-3px);
            border-color: var(--primary);
        }

        .persona-card strong {
            font-size: 1.05rem;
        }

        .chat-shell {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .chat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.75rem;
        }

        .chat-header-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .chat-header span {
            color: var(--muted);
            font-size: 0.9rem;
        }

        .chat-window {
            border: 1px solid var(--border);
            border-radius: 1rem;
            padding: 1rem;
            min-height: 320px;
            max-height: 480px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 0.85rem;
            background: color-mix(in srgb, var(--card) 85%, transparent);
        }

        .message {
            max-width: 88%;
            padding: 0.75rem 0.95rem;
            border-radius: 1rem;
            font-size: 0.95rem;
            line-height: 1.45;
            position: relative;
        }

        .message.user {
            align-self: flex-end;
            background: var(--primary);
            color: var(--primary-foreground);
            border-bottom-right-radius: 0.5rem;
        }

        .message.assistant {
            align-self: flex-start;
            background: color-mix(in srgb, var(--primary) 12%, transparent);
            border-bottom-left-radius: 0.5rem;
        }

        .message.system {
            align-self: center;
            background: transparent;
            color: var(--muted);
            font-size: 0.85rem;
        }

        .typing {
            display: inline-flex;
            gap: 0.25rem;
        }

        .typing span {
            width: 7px;
            height: 7px;
            border-radius: 999px;
            background: currentColor;
            opacity: 0.3;
            animation: typing 1s infinite;
        }

        .typing span:nth-child(2) {
            animation-delay: 0.15s;
        }

        .typing span:nth-child(3) {
            animation-delay: 0.3s;
        }

        @keyframes typing {
            0%, 100% { opacity: 0.25; transform: translateY(0); }
            50% { opacity: 0.8; transform: translateY(-2px); }
        }

        .quick-replies {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .quick-replies button {
            border: 1px solid var(--border);
            border-radius: 999px;
            background: transparent;
            color: var(--muted);
            padding: 0.4rem 0.85rem;
            cursor: pointer;
            font-size: 0.85rem;
            transition: border-color 0.2s ease, transform 0.2s ease;
        }

        .quick-replies button:hover {
            border-color: var(--primary);
            color: var(--foreground);
            transform: translateY(-1px);
        }

        .composer {
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 0.75rem;
            align-items: end;
        }

        .composer textarea {
            resize: none;
            min-height: 64px;
            max-height: 130px;
            border-radius: 0.9rem;
            border: 1px solid var(--border);
            padding: 0.75rem;
            background: color-mix(in srgb, var(--card) 90%, transparent);
            font-family: inherit;
            font-size: 0.95rem;
            color: inherit;
        }

        .composer textarea:focus {
            outline: 2px solid color-mix(in srgb, var(--primary) 30%, transparent);
            outline-offset: 2px;
        }

        .send-button {
            padding: 0.75rem 1.25rem;
            border-radius: 0.9rem;
            border: none;
            font-weight: 600;
            background: linear-gradient(135deg, var(--primary), color-mix(in srgb, var(--primary) 65%, #fb7185));
            color: var(--primary-foreground);
            cursor: pointer;
            transition: transform 0.2s ease, opacity 0.2s ease;
        }

        .send-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .record-button {
            border-radius: 0.9rem;
            border: 1px solid var(--border);
            background: color-mix(in srgb, var(--primary) 10%, transparent);
            color: var(--foreground);
            padding: 0.65rem 0.95rem;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            transition: border-color 0.2s ease, transform 0.2s ease, background 0.2s ease;
        }

        .record-button svg {
            width: 16px;
            height: 16px;
        }

        .record-button.is-recording {
            border-color: transparent;
            background: #dc2626;
            color: #ffffff;
            animation: pulse 1.2s infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.35); }
            50% { box-shadow: 0 0 0 8px rgba(220, 38, 38, 0); }
        }

        .record-status {
            font-size: 0.8rem;
            color: var(--muted);
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }

        .product-card {
            border: 1px solid var(--border);
            border-radius: 1rem;
            overflow: hidden;
            background: color-mix(in srgb, var(--card) 88%, transparent);
            display: flex;
            flex-direction: column;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .product-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 20px -12px rgb(0 0 0 / 0.3);
        }

        .product-card img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            background: color-mix(in srgb, var(--primary) 6%, transparent);
        }

        .product-card span {
            padding: 0.85rem;
            font-size: 0.95rem;
        }

        .products-info {
            font-size: 0.85rem;
            color: var(--muted);
            margin-bottom: 0.75rem;
        }

        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            padding: 1.5rem;
            z-index: 50;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            position: relative;
            max-width: min(92vw, 640px);
            max-height: 90vh;
        }

        .modal-content img {
            width: 100%;
            height: auto;
            max-height: 90vh;
            border-radius: 1rem;
            box-shadow: 0 25px 30px -10px rgb(0 0 0 / 0.45);
        }

        .modal-close {
            position: absolute;
            top: 0.85rem;
            right: 0.85rem;
            width: 42px;
            height: 42px;
            border-radius: 999px;
            border: none;
            background: rgba(15, 23, 42, 0.85);
            color: #ffffff;
            cursor: pointer;
            font-size: 1.25rem;
        }

        .contact-list {
            display: grid;
            gap: 0.75rem;
        }

        .contact-card {
            border: 1px solid var(--border);
            border-radius: 1rem;
            padding: 1rem;
            background: color-mix(in srgb, var(--card) 92%, transparent);
        }

        .contact-card strong {
            display: block;
            margin-bottom: 0.25rem;
        }

        .knowledge-list li + li,
        .checklist li + li {
            margin-top: 0.35rem;
        }

        .quiz-placeholder {
            border: 1px dashed var(--border);
            border-radius: 1rem;
            padding: 1.25rem;
            display: grid;
            gap: 0.75rem;
            text-align: center;
            background: color-mix(in srgb, var(--card) 80%, transparent);
        }

        .subtle-link {
            color: var(--primary);
            text-decoration: none;
        }

        .subtle-link:hover {
            text-decoration: underline;
        }

        @media (max-width: 640px) {
            main {
                padding: 1.25rem 1rem 2.5rem;
            }

            .menu-grid {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }

            .chat-window {
                min-height: 280px;
                max-height: 420px;
            }

            .persona-grid {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="app-shell">
        <header>
            <div class="header-inner">
                <div class="header-group">
                    <button id="backButton" class="icon-button" aria-label="–ù–∞–∑–∞–¥" disabled>‚Üê</button>
                    <div>
                        <h1 id="headerTitle" style="font-size: 1.1rem; font-weight: 700;">–Ü–¥–µ–∞–ª—å–Ω–∏–π –ü—Ä–æ–¥–∞–≤–µ—Ü—å 2.0</h1>
                        <span id="headerSubtitle" style="font-size: 0.85rem; color: var(--muted);">–í—Å–µ –¥–ª—è —É—Å–ø—ñ—à–Ω–æ—ó –∑–º—ñ–Ω–∏</span>
                    </div>
                </div>
                <div class="header-group">
                    <button id="refreshButton" class="icon-button" aria-label="–û–Ω–æ–≤–∏—Ç–∏" title="–û–Ω–æ–≤–∏—Ç–∏ –¥–∞–Ω—ñ">‚ü≥</button>
                    <button id="themeToggle" class="icon-button" aria-label="–ó–º—ñ–Ω–∏—Ç–∏ —Ç–µ–º—É">‚òÄÔ∏è</button>
                </div>
            </div>
        </header>

        <main id="appMain">
            <section id="home" class="page active" aria-labelledby="headerTitle">
                <div class="welcome-card">
                    <strong id="welcomeHeadline">–í—ñ—Ç–∞—î–º–æ, –∫–æ–ª–µ–≥–æ!</strong>
                    <span>–û–±–∏—Ä–∞–π—Ç–µ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —ñ –≤–∏—Ä—É—à–∞–π—Ç–µ –≤ –∑–º—ñ–Ω—É –∑ –ø–æ—Å–º—ñ—à–∫–æ—é.</span>
                </div>
                <div class="menu-grid" role="menu">
                    <article class="menu-card" data-target="assistant">
                        <div class="menu-icon">ü§ñ</div>
                        <div>
                            <h3 style="margin-bottom: 0.25rem;">–®–Ü-–ø–æ–º—ñ—á–Ω–∏–∫</h3>
                            <p style="color: var(--muted); font-size: 0.85rem;">–ú–∏—Ç—Ç—î–≤—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –Ω–∞ —Ä–æ–±–æ—á—ñ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è.</p>
                        </div>
                    </article>
                    <article class="menu-card" data-target="knowledge">
                        <div class="menu-icon">üìö</div>
                        <div>
                            <h3 style="margin-bottom: 0.25rem;">–ë–∞–∑–∞ –ó–Ω–∞–Ω—å</h3>
                            <p style="color: var(--muted); font-size: 0.85rem;">–ü–æ–∫—Ä–æ–∫–æ–≤—ñ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó —Ç–∞ —Å–∫—Ä–∏–ø—Ç–∏.</p>
                        </div>
                    </article>
                    <article class="menu-card" data-target="checklists">
                        <div class="menu-icon">‚úÖ</div>
                        <div>
                            <h3 style="margin-bottom: 0.25rem;">–ß–µ–∫-–ª–∏—Å—Ç–∏</h3>
                            <p style="color: var(--muted); font-size: 0.85rem;">–ö–æ–Ω—Ç—Ä–æ–ª—å —â–æ–¥–µ–Ω–Ω–∏—Ö —Ä—É—Ç–∏–Ω.</p>
                        </div>
                    </article>
                    <article class="menu-card" data-target="products">
                        <div class="menu-icon">üõí</div>
                        <div>
                            <h3 style="margin-bottom: 0.25rem;">–ù–∞—à–∞ –ü—Ä–æ–¥—É–∫—Ü—ñ—è</h3>
                            <p style="color: var(--muted); font-size: 0.85rem;">–ö–∞—Ç–∞–ª–æ–≥ ¬´–ì–∞–ª—è –ë–∞–ª—É–≤–∞–Ω–∞¬ª.</p>
                        </div>
                    </article>
                    <article class="menu-card" data-target="quiz">
                        <div class="menu-icon">üéØ</div>
                        <div>
                            <h3 style="margin-bottom: 0.25rem;">–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ó–Ω–∞–Ω—å</h3>
                            <p style="color: var(--muted); font-size: 0.85rem;">–¢–µ—Å—Ç–∏ —Ç–∞ —Ç—Ä–µ–Ω–∞–∂–µ—Ä–∏.</p>
                        </div>
                    </article>
                    <article class="menu-card" data-target="contacts">
                        <div class="menu-icon">üìû</div>
                        <div>
                            <h3 style="margin-bottom: 0.25rem;">–ö–æ—Ä–∏—Å–Ω—ñ –ö–æ–Ω—Ç–∞–∫—Ç–∏</h3>
                            <p style="color: var(--muted); font-size: 0.85rem;">–ó–≤'—è–∑–æ–∫ –∑ –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–∞–º–∏.</p>
                        </div>
                    </article>
                </div>
            </section>

            <section id="assistant" class="page" aria-live="polite">
                <h2 class="section-title">–®–Ü-–ø–æ–º—ñ—á–Ω–∏–∫</h2>
                <div id="personaSelection">
                    <p style="color: var(--muted); margin-bottom: 1.25rem;">–û–±–µ—Ä—ñ—Ç—å ¬´–æ—Å–æ–±–∏—Å—Ç—ñ—Å—Ç—å¬ª –ø–æ–º—ñ—á–Ω–∏–∫–∞, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ.</p>
                    <div class="persona-grid">
                        <article class="persona-card" data-persona="seller">
                            <span class="badge">üî∏ –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ</span>
                            <strong>–®–Ü-–ø—Ä–æ–¥–∞–≤–µ—Ü—å</strong>
                            <p style="color: var(--muted); font-size: 0.9rem;">–†—ñ—à–µ–Ω–Ω—è –¥–ª—è –∫–∞—Å–∏, –ø–æ–≤–µ—Ä–Ω–µ–Ω—å, —Å–µ—Ä–≤—ñ—Å—É —Ç–∞ —Ä–æ–±–æ—Ç–∏ –∑ –∫–ª—ñ—î–Ω—Ç–∞–º–∏.</p>
                        </article>
                        <article class="persona-card" data-persona="cosmetologist">
                            <strong>–®–Ü-–∫–æ—Å–º–µ—Ç–æ–ª–æ–≥</strong>
                            <p style="color: var(--muted); font-size: 0.9rem;">–ü–æ—Ä–∞–¥–∏ –∑ –¥–æ–≥–ª—è–¥—É —Ç–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—ó —â–æ–¥–æ –∞—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç—É –∫–æ—Å–º–µ—Ç–∏–∫–∏.</p>
                        </article>
                        <article class="persona-card" data-persona="study">
                            <strong>–ü–æ–º—ñ—á–Ω–∏–∫ –∑ —É—Ä–æ–∫–∞–º–∏</strong>
                            <p style="color: var(--muted); font-size: 0.9rem;">–ü–æ—è—Å–Ω–∏—Ç—å –Ω–∞–≤—á–∞–ª—å–Ω—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏, –¥–æ–ø–æ–º–æ–∂–µ –∑–∞–∫—Ä—ñ–ø–∏—Ç–∏ –∑–Ω–∞–Ω–Ω—è.</p>
                        </article>
                        <article class="persona-card" data-persona="chitchat">
                            <strong>–ü—Ä–æ—Å—Ç–æ –ø–æ—Ç–µ—Ä–µ–≤–µ–Ω—å–∫–∞—Ç–∏</strong>
                            <p style="color: var(--muted); font-size: 0.9rem;">–ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –Ω–∞—Å—Ç—Ä–æ—é —Ç–∞ –Ω–µ—Ñ–æ—Ä–º–∞–ª—å–Ω—ñ —Ä–æ–∑–º–æ–≤–∏ –ø—ñ–¥ —á–∞—Å –ø–µ—Ä–µ—Ä–≤–∏.</p>
                        </article>
                    </div>
                </div>

                <div id="chatArea" class="chat-shell" hidden>
                    <div class="chat-header">
                        <div class="chat-header-info">
                            <strong id="personaTitle">–®–Ü-–ø—Ä–æ–¥–∞–≤–µ—Ü—å</strong>
                            <span id="personaSubtitle">–í–∞—à —Ü–∏—Ñ—Ä–æ–≤–∏–π –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫</span>
                        </div>
                        <button id="changePersona" class="record-button" type="button">–ó–º—ñ–Ω–∏—Ç–∏ –ø–µ—Ä—Å–æ–Ω—É</button>
                    </div>

                    <div id="quickReplies" class="quick-replies" hidden></div>

                    <div id="chatWindow" class="chat-window" role="log" aria-live="polite"></div>

                    <div>
                        <div id="recordStatus" class="record-status"></div>
                        <div class="composer">
                            <button id="recordButton" class="record-button" type="button">
                                <span aria-hidden="true">‚óè</span>
                                <span>–ì–æ–ª–æ—Å</span>
                            </button>
                            <textarea id="messageInput" placeholder="–ù–∞–ø–∏—à—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è..." rows="2"></textarea>
                            <button id="sendButton" class="send-button" type="button">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏</button>
                        </div>
                    </div>
                </div>
            </section>

            <section id="knowledge" class="page">
                <h2 class="section-title">–ë–∞–∑–∞ –∑–Ω–∞–Ω—å ¬´–ì–∞–ª—è –ë–∞–ª—É–≤–∞–Ω–∞¬ª</h2>
                <p style="color: var(--muted); margin-bottom: 1rem;">–°–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ—Å—å —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è–º–∏, —â–æ–± –≤–ø–µ–≤–Ω–µ–Ω–æ –ø–æ—á—É–≤–∞—Ç–∏—Å—è –Ω–∞ –∑–º—ñ–Ω—ñ.</p>
                <div id="knowledgeList"></div>
            </section>

            <section id="checklists" class="page">
                <h2 class="section-title">–ß–µ–∫-–ª–∏—Å—Ç–∏ –∑–º—ñ–Ω–∏</h2>
                <div class="card">
                    <h3 style="margin-bottom: 0.5rem;">–†–∞–Ω–∫–æ–≤–∏–π —Å—Ç–∞—Ä—Ç</h3>
                    <ol class="checklist" style="color: var(--muted);">
                        <li>–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –≥—Ä–∞—Ñ—ñ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏ –π –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –∫–ª—é—á–æ–≤–∏—Ö —Ç–æ–≤–∞—Ä—ñ–≤.</li>
                        <li>–£–≤—ñ–º–∫–Ω—ñ—Ç—å –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è: –∫–∞—Å—É Poster, —Ç–µ—Ä–º—ñ–Ω–∞–ª, —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∏.</li>
                        <li>–ü—Ä–æ–≤–µ–¥—ñ—Ç—å —Å–∞–Ω—ñ—Ç–∞—Ä–Ω–∏–π —á–µ–∫: —Ä—É–∫–∏, —Ñ–æ—Ä–º–∞, —á–∏—Å—Ç–æ—Ç–∞ –≤—ñ—Ç—Ä–∏–Ω–∏.</li>
                        <li>–û–Ω–æ–≤—ñ—Ç—å –≤–∏–∫–ª–∞–¥–∫—É –∑–∞ –ø—Ä–∏–Ω—Ü–∏–ø–æ–º <strong>FIFO</strong> —Ç–∞ —Ñ–µ–π—Å–∏–Ω–≥–æ–º.</li>
                        <li>–ü—Ä–∏–≤—ñ—Ç–∞–π—Ç–µ –ø–µ—Ä—à–∏—Ö –≥–æ—Å—Ç–µ–π —Ç–∞ —É—Ç–æ—á–Ω—ñ—Ç—å —ó—Ö –ø–æ—Ç—Ä–µ–±–∏.</li>
                    </ol>
                </div>
                <div class="card">
                    <h3 style="margin-bottom: 0.5rem;">–ü—ñ–¥ —á–∞—Å –∑–º—ñ–Ω–∏</h3>
                    <ol class="checklist" style="color: var(--muted);">
                        <li>–í–µ–¥—ñ—Ç—å –ø—Ä–æ–¥–∞–∂—ñ –≤ Poster, –¥–æ–¥–∞–≤–∞–π—Ç–µ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ –¥–æ —Å–∫–ª–∞–¥–Ω–∏—Ö —á–µ–∫—ñ–≤.</li>
                        <li>–ö–æ–Ω—Ç—Ä–æ–ª—é–π—Ç–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏—Ö –∑–æ–Ω (‚â§5¬∞C) —Ç–∞ –≥–∞—Ä—è—á–∏—Ö —Å—Ç—Ä–∞–≤ (‚â•63¬∞C).</li>
                        <li>–§—ñ–∫—Å—É–π—Ç–µ —Å–ª—É–∂–±–æ–≤—ñ –≤–Ω–µ—Å–µ–Ω–Ω—è/–≤–∏–¥–∞—á—ñ –∑ –∫–æ—Ä–æ—Ç–∫–∏–º –æ–ø–∏—Å–æ–º.</li>
                        <li>–ü—Ä–æ–ø–æ–Ω—É–π—Ç–µ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –ø—Ä–æ–¥—É–∫—Ç–∏ –∑–≥—ñ–¥–Ω–æ —Å–µ—Ä–≤—ñ—Å-—Å–∫—Ä–∏–ø—Ç—ñ–≤.</li>
                        <li>–í–µ–¥—ñ—Ç—å –∂—É—Ä–Ω–∞–ª —Å–∫–∞—Ä–≥/–ø–æ–±–∞–∂–∞–Ω—å –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞.</li>
                    </ol>
                </div>
                <div class="card">
                    <h3 style="margin-bottom: 0.5rem;">–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è –∑–º—ñ–Ω–∏</h3>
                    <ol class="checklist" style="color: var(--muted);">
                        <li>–ü—Ä–æ–≤–µ–¥—ñ—Ç—å –∑–≤—ñ—Ä–∫—É –≥–æ—Ç—ñ–≤–∫–∏ —Ç–∞ —Å—Ñ–æ—Ä–º—É–π—Ç–µ <strong>Z-–∑–≤—ñ—Ç</strong> —É –ü–†–†–û.</li>
                        <li>–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏—Å—Ç–æ—Ç—É —Ç–∞ –∑–∞–∫—Ä–∏–π—Ç–µ –≤—ñ—Ç—Ä–∏–Ω–∏, –≤–∏–º–∫–Ω—ñ—Ç—å –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è.</li>
                        <li>–ü–æ–ø–æ–≤–Ω—ñ—Ç—å —Ä–æ–∑–º—ñ–Ω –∑–∞ –ø–æ—Ç—Ä–µ–±–∏, –ø—ñ–¥–≥–æ—Ç—É–π—Ç–µ –∑–≤—ñ—Ç –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞.</li>
                        <li>–û—Ñ–æ—Ä–º—ñ—Ç—å –ø–µ—Ä–µ–¥–∞—á—É –∑–º—ñ–Ω–∏ —Ç–∞ –∑–∞—Ñ—ñ–∫—Å—É–π—Ç–µ –ø–æ–∫–∞–∑–Ω–∏–∫–∏ –ø—Ä–æ–¥–∞–∂—ñ–≤.</li>
                    </ol>
                </div>
            </section>

            <section id="products" class="page">
                <h2 class="section-title">–ù–∞—à–∞ –ø—Ä–æ–¥—É–∫—Ü—ñ—è</h2>
                <p class="products-info">–ö–∞—Ç–∞–ª–æ–≥ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ. –û–±–µ—Ä—ñ—Ç—å –∫–∞—Ä—Ç–∫—É, —â–æ–± –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è —É –ø–æ–≤–Ω–æ–º—É —Ä–æ–∑–º—ñ—Ä—ñ.</p>
                <div id="productsState" class="products-info"></div>
                <div id="productGrid" class="product-grid" aria-live="polite"></div>
            </section>

            <section id="quiz" class="page">
                <h2 class="section-title">–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–Ω–∞–Ω—å</h2>
                <div class="quiz-placeholder">
                    <p>–Ü—Ç–µ—Ä–∞—Ü—ñ—è 1: –º–∏ –∑–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –ø—Ä–æ –≤–∞—à –ø—Ä–æ–≥—Ä–µ—Å —É —á–∞—Ç—ñ —Ç–∞ —á–µ–∫-–ª–∏—Å—Ç–∞—Ö. –£ –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ –∑'—è–≤–ª—è—Ç—å—Å—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ñ —Ç–µ—Å—Ç–∏ –∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–º –Ω–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –±–∞–ª—ñ–≤.</p>
                    <p style="color: var(--muted);">–ü–æ–∫–∏ —â–æ —Ä–∞–¥–∏–º–æ –ø—Ä–æ–π—Ç–∏ –∫–æ—Ä–æ—Ç–∫–µ —Å–∞–º–æ—Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∑ –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–æ–º.</p>
                </div>
            </section>

            <section id="contacts" class="page">
                <h2 class="section-title">–ö–æ—Ä–∏—Å–Ω—ñ –∫–æ–Ω—Ç–∞–∫—Ç–∏</h2>
                <div class="contact-list">
                    <article class="contact-card">
                        <strong>–ú–µ–Ω–µ–¥–∂–µ—Ä –º–∞–≥–∞–∑–∏–Ω—É</strong>
                        <div style="color: var(--muted);">–ú–∞—Ä—ñ—è –ö–æ–≤–∞–ª—å ‚Ä¢ +38 (067) 000-00-01</div>
                        <div style="color: var(--muted);">–ü–∏—Ç–∞–Ω–Ω—è –∑–º—ñ–Ω, –≥—Ä–∞—Ñ—ñ–∫, –ø–æ–±–∞–∂–∞–Ω–Ω—è –∫–ª—ñ—î–Ω—Ç—ñ–≤.</div>
                    </article>
                    <article class="contact-card">
                        <strong>HR-–Ω–∞—Å—Ç–∞–≤–Ω–∏–∫</strong>
                        <div style="color: var(--muted);">–Ü–≥–æ—Ä –°–∞–≤—á—É–∫ ‚Ä¢ +38 (050) 000-00-02</div>
                        <div style="color: var(--muted);">–û–Ω–±–æ—Ä–¥–∏–Ω–≥, –Ω–∞–≤—á–∞–Ω–Ω—è, –¥–æ–∫—É–º–µ–Ω—Ç–∏.</div>
                    </article>
                    <article class="contact-card">
                        <strong>–õ—ñ–Ω—ñ—è –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ Poster</strong>
                        <div style="color: var(--muted);">support@joinposter.com</div>
                        <a class="subtle-link" href="https://knowledge-base.joinposter.com/uk-ua" target="_blank" rel="noopener">–ë–∞–∑–∞ –∑–Ω–∞–Ω—å Poster ‚Üí</a>
                    </article>
                </div>
            </section>
        </main>
    </div>

    <div id="imageModal" class="modal" role="dialog" aria-modal="true" aria-label="–ü–µ—Ä–µ–≥–ª—è–¥ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è">
        <div class="modal-content">
            <button id="modalClose" class="modal-close" aria-label="–ó–∞–∫—Ä–∏—Ç–∏">√ó</button>
            <img id="modalImage" src="" alt="–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç—É">
        </div>
    </div>

    <script>
        (function () {
            const WEBHOOK_URL = "https://example.com/gb-assistant";
            const tg = window.Telegram ? window.Telegram.WebApp : undefined;

            function detectPlatform() {
                const ua = navigator.userAgent || '';
                const platform = navigator.userAgentData?.platform || navigator.platform || '';
                if (/iPad|iPhone|iPod/.test(ua)) return 'ios';
                if (/Android/.test(ua)) return 'android';
                if (/Mac/.test(platform)) return 'mac';
                if (/Win/.test(platform)) return 'windows';
                return 'other';
            }

            document.documentElement.dataset.platform = detectPlatform();
            if (tg) {
                try {
                    tg.ready();
                    tg.expand();
                } catch (error) {
                    console.warn("Telegram WebApp init failed", error);
                }
            }

            const initData = tg?.initData || "";
            const userData = tg?.initDataUnsafe?.user || {};

            const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            const themeToggle = document.getElementById('themeToggle');

            function persistTheme(theme) {
                try {
                    localStorage.setItem('ideal-seller-theme', theme);
                } catch (error) {
                    console.warn('Cannot persist theme preference', error);
                }
            }

            function applyTheme(theme) {
                if (theme === 'dark') {
                    document.documentElement.classList.add('dark');
                    themeToggle?.textContent = 'üåô';
                } else {
                    document.documentElement.classList.remove('dark');
                    themeToggle?.textContent = '‚òÄÔ∏è';
                }
                persistTheme(theme);
            }

            let savedTheme = null;
            try {
                savedTheme = localStorage.getItem('ideal-seller-theme');
            } catch (error) {
                console.warn('Cannot read saved theme', error);
            }
            if (tg?.colorScheme === 'dark' || savedTheme === 'dark' || (!savedTheme && prefersDark)) {
                applyTheme('dark');
            } else {
                applyTheme('light');
            }

            themeToggle?.addEventListener('click', () => {
                const isDark = document.documentElement.classList.toggle('dark');
                applyTheme(isDark ? 'dark' : 'light');
            });

            const firstName = userData?.first_name ? userData.first_name : '–∫–æ–ª–µ–≥–æ';
            const welcomeHeadline = document.getElementById('welcomeHeadline');
            welcomeHeadline.textContent = `–í—ñ—Ç–∞—î–º–æ, ${firstName}!`;

            const headerTitle = document.getElementById('headerTitle');
            const headerSubtitle = document.getElementById('headerSubtitle');
            const backButton = document.getElementById('backButton');
            const refreshButton = document.getElementById('refreshButton');
            const pages = document.querySelectorAll('.page');
            const menuCards = document.querySelectorAll('.menu-card');
            const appMain = document.getElementById('appMain');
            let currentPage = 'home';

            function focusFirstInteractive(pageId) {
                window.requestAnimationFrame(() => {
                    const page = document.getElementById(pageId);
                    if (!page) return;
                    const focusable = page.querySelector('button, a, textarea, input');
                    focusable?.focus({ preventScroll: true });
                });
            }

            function setPage(pageId) {
                pages.forEach((page) => {
                    page.classList.toggle('active', page.id === pageId);
                });
                currentPage = pageId;
                const isHome = pageId === 'home';
                backButton.disabled = isHome;
                const activePage = document.getElementById(pageId);
                const pageHeading = activePage?.querySelector('h2, h3');
                headerTitle.textContent = isHome ? '–Ü–¥–µ–∞–ª—å–Ω–∏–π –ü—Ä–æ–¥–∞–≤–µ—Ü—å 2.0' : pageHeading?.textContent || '–Ü–¥–µ–∞–ª—å–Ω–∏–π –ü—Ä–æ–¥–∞–≤–µ—Ü—å 2.0';
                headerSubtitle.textContent = isHome ? '–í—Å–µ –¥–ª—è —É—Å–ø—ñ—à–Ω–æ—ó –∑–º—ñ–Ω–∏' : '–ü–æ–≤–µ—Ä–Ω—ñ—Ç—å—Å—è, —â–æ–± –æ–±—Ä–∞—Ç–∏ —ñ–Ω—à–∏–π —Ä–æ–∑–¥—ñ–ª';
                focusFirstInteractive(pageId);
            }

            backButton.addEventListener('click', () => {
                if (currentPage !== 'home') {
                    setPage('home');
                }
            });

            menuCards.forEach((card) => {
                card.addEventListener('click', () => {
                    const target = card.getAttribute('data-target');
                    if (!target) return;
                    setPage(target);
                    if (target === 'products') {
                        fetchProducts();
                    }
                });
            });

            refreshButton.addEventListener('click', () => {
                if (currentPage === 'products') {
                    fetchProducts(true);
                } else if (currentPage === 'assistant' && selectedPersona) {
                    sendSystemMessage('–û—á–∏—Å—Ç–∏–ª–∏ —á–∞—Ç. –û–±–µ—Ä—ñ—Ç—å –Ω–æ–≤—É —Ç–µ–º—É –∞–±–æ –Ω–∞–ø–∏—à—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è.');
                    chatWindow.innerHTML = '';
                }
            });

            const knowledgeContent = [
                {
                    title: '–†–æ–±–æ—Ç–∞ –∑—ñ –∑–º—ñ–Ω–æ—é –≤ Poster',
                    items: [
                        '–ö–æ–∂–µ–Ω –ø—Ä–æ–¥–∞–≤–µ—Ü—å –º–∞—î –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏–π –ª–æ–≥—ñ–Ω, –ø–∞—Ä–æ–ª—å —ñ –ü–Ü–ù. –ù–µ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ —ó—Ö –∫–æ–ª–µ–≥–∞–º.',
                        '–í—Ö—ñ–¥: [–∑–∞–∫–ª–∞–¥].joinposter.com ‚Üí –ª–æ–≥—ñ–Ω/–ø–∞—Ä–æ–ª—å ‚Üí –ü–Ü–ù. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å, —â–æ –∫–∞—Å–æ–≤–∏–π –¥–µ–Ω—å –≤—ñ–¥–∫—Ä–∏—Ç–∏–π.',
                        '–î–æ–¥–∞–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É: –ø–æ—à—É–∫, –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –∞–±–æ —Å–∫–∞–Ω–µ—Ä —à—Ç—Ä–∏—Ö–∫–æ–¥—É. –ö–æ–Ω—Ç—Ä–æ–ª—é–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ—Å—Ç—å —Ü—ñ–Ω–∏ —ñ –∑–Ω–∏–∂–æ–∫.',
                        '–û–ø–ª–∞—Ç–∞: –ø—Ä–∏–π–º–∞–π—Ç–µ –≥–æ—Ç—ñ–≤–∫—É, –∫–∞—Ä—Ç–∫–∏, —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏. –î–ª—è –∑–º—ñ—à–∞–Ω–æ—ó –æ–ø–ª–∞—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ split-payment.',
                        'X-–∑–≤—ñ—Ç –¥–æ–∑–≤–æ–ª—è—î –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≥–æ—Ç—ñ–≤–∫—É –ø—Ä–æ—Ç—è–≥–æ–º –¥–Ω—è, Z-–∑–≤—ñ—Ç –∑–∞–∫—Ä–∏–≤–∞—î –∑–º—ñ–Ω—É —ñ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î –¥–∞–Ω—ñ –¥–æ –î–ü–°.'
                    ]
                },
                {
                    title: '–ü–†–†–û 2.0: —Ñ—ñ—Å–∫–∞–ª—ñ–∑–∞—Ü—ñ—è –±–µ–∑ –ø–∞–Ω—ñ–∫–∏',
                    items: [
                        '–ü–†–†–û –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–µ—Ä–µ–¥–∞—î —á–µ–∫–∏ –≤ –ø–æ–¥–∞—Ç–∫–æ–≤—É. –Ø–∫—â–æ –Ω–µ–º–∞—î –∑–≤'—è–∑–∫—É, —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–∞—Ü—é—î –æ—Ñ–ª–∞–π–Ω –¥–æ 36 –≥–æ–¥–∏–Ω.',
                        '–ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∏–π —á–µ–∫ –º–æ–∂–Ω–∞ –ø–æ–∫–∞–∑–∞—Ç–∏ –∫–ª—ñ—î–Ω—Ç—É —É –≤–∏–≥–ª—è–¥—ñ QR-–∫–æ–¥—É –∞–±–æ –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –Ω–∞ email/SMS.',
                        '–î–ª—è –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –æ—Ñ–æ—Ä–º—ñ—Ç—å –∫–æ—Ä–∏–≥—É—é—á–∏–π —á–µ–∫. –û–±–æ–≤ º—è–∑–∫–æ–≤–æ –ø–æ—è—Å–Ω—ñ—Ç—å –ø—Ä–∏—á–∏–Ω—É —Ç–∞ –∑–∞—Ñ—ñ–∫—Å—É–π—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç –∫–ª—ñ—î–Ω—Ç–∞.',
                        '–ü—ñ—Å–ª—è –∑–∞–∫—Ä–∏—Ç—Ç—è –∑–º—ñ–Ω–∏ —Å—Ñ–æ—Ä–º—É–π—Ç–µ Z-–∑–≤—ñ—Ç —É –ü–†–†–û —Ç–∞ –ø–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å, —â–æ –≤—ñ–Ω —É—Å–ø—ñ—à–Ω–æ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–∏–π.'
                    ]
                },
                {
                    title: '–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏ —Å–µ—Ä–≤—ñ—Å—É',
                    items: [
                        '–ü—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è: ¬´–î–æ–±—Ä–æ–≥–æ –¥–Ω—è! –í—ñ—Ç–∞—î–º–æ —É ‚Äú–ì–∞–ª—è –ë–∞–ª—É–≤–∞–Ω–∞‚Äù. –ß–∏–º –º–æ–∂—É –¥–æ–ø–æ–º–æ–≥—Ç–∏?¬ª',
                        '–£—Ç–æ—á–Ω–µ–Ω–Ω—è –ø–æ—Ç—Ä–µ–±–∏: —Å—Ç–∞–≤—Ç–µ –≤—ñ–¥–∫—Ä–∏—Ç—ñ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è —ñ –ø—Ä–æ–ø–æ–Ω—É–π—Ç–µ —Ä—ñ—à–µ–Ω–Ω—è, –∞ –Ω–µ –ª–∏—à–µ —Ç–æ–≤–∞—Ä.',
                        '–ê–ø- —Ç–∞ –∫—Ä–æ—Å-—Å–µ–ª: ¬´–î–æ –≤–∞—Ä–µ–Ω–∏–∫—ñ–≤ —Ä–∞–¥–∏–º–æ –Ω–∞—à —Å–º–µ—Ç–∞–Ω–∫–æ–≤–∏–π —Å–æ—É—Å. –°–ø—Ä–æ–±—É—î—Ç–µ?¬ª',
                        '–†–æ–±–æ—Ç–∞ –∑—ñ —Å–∫–∞—Ä–≥–æ—é: —Å–ª—É—Ö–∞–π—Ç–µ, –µ–º–ø–∞—Ç–∏—á–Ω–æ —Ä–µ–∞–≥—É–π—Ç–µ, –∑–∞–ø—Ä–æ–ø–æ–Ω—É–π—Ç–µ —Ä—ñ—à–µ–Ω–Ω—è —ñ –∑–∞—Ñ—ñ–∫—Å—É–π—Ç–µ –∫–µ–π—Å.'
                    ]
                },
                {
                    title: '–ê–ª–≥–æ—Ä–∏—Ç–º–∏ –¥–ª—è —Å–∫–ª–∞–¥–Ω–∏—Ö —Å–∏—Ç—É–∞—Ü—ñ–π',
                    items: [
                        '–ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –±–µ–∑ —á–µ–∫—É: –ø—Ä–∏–π–º–∞—î–º–æ, —è–∫—â–æ —î –µ–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∏–π —á–µ–∫/–±–∞–Ω–∫—ñ–≤—Å—å–∫–∞ –≤–∏–ø–∏—Å–∫–∞/–≤—ñ–¥–µ–æ. –§—ñ–∫—Å—É—î–º–æ –∞–∫—Ç –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è.',
                        '–ê–≥—Ä–µ—Å–∏–≤–Ω–∏–π –∫–ª—ñ—î–Ω—Ç: —Ç–µ—Ö–Ω—ñ–∫–∞ LEARN ‚Äî Listen, Empathize, Ask, Resolve, Next Step. –ó–∞–ª—É—á—ñ—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä–∞, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ.',
                        '–ö–æ–Ω—Ñ–ª—ñ–∫—Ç –º—ñ–∂ –∫–æ–ª–µ–≥–∞–º–∏: –∑–∞—Ñ—ñ–∫—Å—É–π—Ç–µ —Å–∏—Ç—É–∞—Ü—ñ—é, –∑–∞–±–µ–∑–ø–µ—á—Ç–µ —Å–ø–æ–∫—ñ–π –¥–ª—è –≥–æ—Å—Ç–µ–π, –ø–æ–≤—ñ–¥–æ–º—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞.',
                        '–ü—ñ–¥–æ–∑—Ä–∞ –Ω–∞ –∫—Ä–∞–¥—ñ–∂–∫—É: –¥–æ—Ç—Ä–∏–º—É–π—Ç–µ—Å—å –ø—Ä–æ—Ü–µ–¥—É—Ä –±–µ–∑–ø–µ–∫–∏, –Ω–µ –∑–≤–∏–Ω—É–≤–∞—á—É–π—Ç–µ –Ω–∞–ø—Ä—è–º—É, –≤–∏–∫–ª–∏—á—Ç–µ –æ—Ö–æ—Ä–æ–Ω—É –∞–±–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞.'
                    ]
                },
                {
                    title: '–ú–µ—Ä—á–∞–Ω–¥–∞–π–∑–∏–Ω–≥ —Ç–∞ FIFO',
                    items: [
                        '–†–æ—Ç–∞—Ü—ñ—è —Ç–æ–≤–∞—Ä—É: –Ω–æ–≤—ñ –ø–∞—Ä—Ç—ñ—ó —Å—Ç–∞–≤–∏–º–æ –≤–≥–ª–∏–± –ø–æ–ª–∏—Ü—ñ, —Å—Ç–∞—Ä—ñ—à—ñ ‚Äî –Ω–∞ —Ñ–∞—Å–∞–¥.',
                        '–ö–æ–Ω—Ç—Ä–æ–ª—å —Ç–µ—Ä–º—ñ–Ω—ñ–≤ –ø—Ä–∏–¥–∞—Ç–Ω–æ—Å—Ç—ñ —â–æ–∑–º—ñ–Ω–∏. –ü–æ–∑–Ω–∞—á–∞–π—Ç–µ —Ç–æ–≤–∞—Ä–∏, —â–æ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å —Ä–æ–∑–ø—Ä–æ–¥–∞–∂—É.',
                        '–§–µ–π—Å–∏–Ω–≥: –≤–∏—Ä—ñ–≤–Ω—é–π—Ç–µ —É–ø–∞–∫–æ–≤–∫–∏, –¥–æ–¥–∞–≤–∞–π—Ç–µ POS-–º–∞—Ç–µ—Ä—ñ–∞–ª–∏, –ø–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ —Ü—ñ–Ω–Ω–∏–∫–∏.',
                        '–ß–∏—Å—Ç–æ—Ç–∞: –≤—ñ—Ç—Ä–∏–Ω–∏, —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∏ —ñ –∫–∞—Å–æ–≤–∞ –∑–æ–Ω–∞ –ø—Ä–æ—Ç–∏—Ä–∞—é—Ç—å—Å—è —â–æ–Ω–∞–π–º–µ–Ω—à–µ 3 —Ä–∞–∑–∏ –Ω–∞ –¥–µ–Ω—å.'
                    ]
                }
            ];

            const knowledgeList = document.getElementById('knowledgeList');
            knowledgeContent.forEach((section) => {
                const details = document.createElement('details');
                const summary = document.createElement('summary');
                summary.textContent = section.title;
                details.appendChild(summary);

                const list = document.createElement('ul');
                list.classList.add('knowledge-list');
                section.items.forEach((item) => {
                    const li = document.createElement('li');
                    li.textContent = item;
                    list.appendChild(li);
                });
                details.appendChild(list);
                knowledgeList.appendChild(details);
            });

            const personaSelection = document.getElementById('personaSelection');
            const chatArea = document.getElementById('chatArea');
            const personaCards = personaSelection.querySelectorAll('.persona-card');
            const personaTitle = document.getElementById('personaTitle');
            const personaSubtitle = document.getElementById('personaSubtitle');
            const chatWindow = document.getElementById('chatWindow');
            const quickReplies = document.getElementById('quickReplies');
            const messageInput = document.getElementById('messageInput');
            const sendButton = document.getElementById('sendButton');
            const recordButton = document.getElementById('recordButton');
            const changePersona = document.getElementById('changePersona');
            const recordStatus = document.getElementById('recordStatus');

            const personas = {
                seller: {
                    id: 'seller',
                    title: '–®–Ü-–ø—Ä–æ–¥–∞–≤–µ—Ü—å',
                    subtitle: '–í–∞—à –µ–∫—Å–ø–µ—Ä—Ç –∑ —Ä–æ–±–æ—Ç–∏ –≤ –º–∞–≥–∞–∑–∏–Ω—ñ',
                    greeting: '–í—ñ—Ç–∞—é! –Ø –¥–æ–ø–æ–º–æ–∂—É –∑ –∫–∞—Å–æ—é, —Å–µ—Ä–≤—ñ—Å–æ–º —ñ —Å–∫–ª–∞–¥–Ω–∏–º–∏ –∫–ª—ñ—î–Ω—Ç–∞–º–∏. –©–æ –ø—ñ–¥–∫–∞–∑–∞—Ç–∏?',
                    quickReplies: [
                        '–ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –±–µ–∑ —á–µ–∫—É',
                        '–ê–≥—Ä–µ—Å–∏–≤–Ω–∏–π –∫–ª—ñ—î–Ω—Ç',
                        '–Ø–∫ –æ—Ñ–æ—Ä–º–∏—Ç–∏ Z-–∑–≤—ñ—Ç?',
                        '–©–æ —Ä–æ–±–∏—Ç–∏ –∑ –ø—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω–∏–º —Ç–æ–≤–∞—Ä–æ–º?'
                    ]
                },
                cosmetologist: {
                    id: 'cosmetologist',
                    title: '–®–Ü-–∫–æ—Å–º–µ—Ç–æ–ª–æ–≥',
                    subtitle: '–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –∑ –¥–æ–≥–ª—è–¥—É —Ç–∞ –∫—Ä–∞—Å–∏',
                    greeting: '–ü—Ä–∏–≤—ñ—Ç! –ü–æ—Ä–∞–¥–∏—Ç–∏ –∫—Ä–µ–º —á–∏ –ø—ñ–¥—ñ–±—Ä–∞—Ç–∏ —Ä—É—Ç–∏–Ω—É –¥–æ–≥–ª—è–¥—É? –ü–∏—à—ñ—Ç—å, –¥–æ–ø–æ–º–æ–∂—É.',
                    quickReplies: []
                },
                study: {
                    id: 'study',
                    title: '–ü–æ–º—ñ—á–Ω–∏–∫ –∑ —É—Ä–æ–∫–∞–º–∏',
                    subtitle: '–ü–æ—è—Å–Ω—é—î –Ω–∞–≤—á–∞–ª—å–Ω—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏',
                    greeting: '–•–æ–¥—ñ–º–æ —Ä–æ–∑–±–µ—Ä–µ–º–æ—Å—è –∑ –Ω–∞–≤—á–∞–ª—å–Ω–∏–º–∏ –º–æ–¥—É–ª—è–º–∏. –ü—Ä–æ —â–æ –ø–æ–≥–æ–≤–æ—Ä–∏–º–æ —Å–ø–æ—á–∞—Ç–∫—É?',
                    quickReplies: []
                },
                chitchat: {
                    id: 'chitchat',
                    title: '–°–ø—ñ–≤—Ä–æ–∑–º–æ–≤–Ω–∏–∫',
                    subtitle: '–õ–µ–≥–∫–∞ —Ä–æ–∑–º–æ–≤–∞ –¥–ª—è –ø–µ—Ä–µ–ø–æ—á–∏–Ω–∫—É',
                    greeting: '–Ø–∫ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –∑–º—ñ–Ω–∞? –ú–æ–∂—É –ø—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ –±–µ—Å—ñ–¥—É –∞–±–æ –ø—ñ–¥–Ω—è—Ç–∏ –Ω–∞—Å—Ç—Ä—ñ–π!',
                    quickReplies: []
                }
            };

            let selectedPersona = null;
            let isSending = false;
            let mediaRecorder = null;
            let recordChunks = [];
            let isRecording = false;

            function appendMessage(role, content, options = {}) {
                const bubble = document.createElement('div');
                bubble.classList.add('message', role);
                if (options.typing) {
                    bubble.innerHTML = '<div class="typing" aria-hidden="true"><span></span><span></span><span></span></div>';
                } else {
                    bubble.innerHTML = content.replace(/\n/g, '<br>');
                }
                chatWindow.appendChild(bubble);
                chatWindow.scrollTop = chatWindow.scrollHeight;
                return bubble;
            }

            function sendSystemMessage(text) {
                appendMessage('system', text);
            }

            function startChat(persona) {
                selectedPersona = persona;
                personaSelection.hidden = true;
                chatArea.hidden = false;
                chatWindow.innerHTML = '';
                personaTitle.textContent = persona.title;
                personaSubtitle.textContent = persona.subtitle;
                if (persona.quickReplies.length) {
                    quickReplies.innerHTML = '';
                    persona.quickReplies.forEach((item) => {
                        const button = document.createElement('button');
                        button.type = 'button';
                        button.textContent = item;
                        button.addEventListener('click', () => {
                            messageInput.value = item;
                            messageInput.focus();
                        });
                        quickReplies.appendChild(button);
                    });
                    quickReplies.hidden = false;
                } else {
                    quickReplies.hidden = true;
                    quickReplies.innerHTML = '';
                }
                appendMessage('assistant', persona.greeting);
            }

            personaCards.forEach((card) => {
                card.addEventListener('click', () => {
                    const personaKey = card.getAttribute('data-persona');
                    if (!personaKey) return;
                    const persona = personas[personaKey];
                    if (!persona) return;
                    startChat(persona);
                });
            });

            changePersona.addEventListener('click', () => {
                selectedPersona = null;
                chatArea.hidden = true;
                personaSelection.hidden = false;
                chatWindow.innerHTML = '';
            });

            async function blobToBase64(blob) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        const base64data = reader.result?.split(',')[1];
                        if (!base64data) {
                            reject(new Error('–ù–µ –≤–¥–∞–ª–æ—Å—è –∫–æ–¥—É–≤–∞—Ç–∏ –∞—É–¥—ñ–æ'));
                        } else {
                            resolve(base64data);
                        }
                    };
                    reader.onerror = reject;
                    reader.readAsDataURL(blob);
                });
            }

            async function sendMessageToServer(payload) {
                try {
                    const response = await fetch(WEBHOOK_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}`);
                    }
                    const data = await response.json();
                    if (Array.isArray(data) && data[0]?.output) {
                        return data[0].output;
                    }
                    if (data?.output) {
                        return data.output;
                    }
                    return '–û—Ç—Ä–∏–º–∞–Ω–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—å, –∞–ª–µ —ó—ó –Ω–µ –≤–¥–∞–ª–æ—Å—è —Ä–æ–∑–ø—ñ–∑–Ω–∞—Ç–∏.';
                } catch (error) {
                    console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–ø–∏—Ç—É', error);
                    return '–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∑ º—î–¥–Ω–∞–Ω–Ω—è –∞–±–æ —Å–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.';
                }
            }

            async function handleSend({ text, audioBase64 }) {
                if (!selectedPersona || isSending) {
                    return;
                }

                const payload = {
                    persona: selectedPersona.id,
                    initData,
                    timestamp: new Date().toISOString()
                };

                if (text) {
                    payload.text = text;
                }
                if (audioBase64) {
                    payload.audio = audioBase64;
                }

                isSending = true;
                sendButton.disabled = true;
                recordButton.disabled = true;

                const typingBubble = appendMessage('assistant', '', { typing: true });
                const reply = await sendMessageToServer(payload);
                typingBubble.remove();
                appendMessage('assistant', reply || '–í–∏–±–∞—á—Ç–µ, —è –Ω–µ –∑—Ä–æ–∑—É–º—ñ–≤ –∑–∞–ø–∏—Ç. –°–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª—é–≤–∞—Ç–∏.');

                isSending = false;
                sendButton.disabled = false;
                recordButton.disabled = false;
            }

            sendButton.addEventListener('click', async () => {
                const text = messageInput.value.trim();
                if (!text || !selectedPersona) {
                    return;
                }
                appendMessage('user', text);
                messageInput.value = '';
                await handleSend({ text });
            });

            messageInput.addEventListener('keydown', async (event) => {
                if (event.key === 'Enter' && !event.shiftKey) {
                    event.preventDefault();
                    sendButton.click();
                }
            });

            async function stopRecording() {
                if (!mediaRecorder) return;
                mediaRecorder.stop();
            }

            recordButton.addEventListener('click', async () => {
                if (!selectedPersona) {
                    sendSystemMessage('–°–ø–µ—Ä—à—É –æ–±–µ—Ä—ñ—Ç—å –ø–µ—Ä—Å–æ–Ω—É, —â–æ–± —Ä–æ–∑–ø–æ—á–∞—Ç–∏ —Å–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—è.');
                    return;
                }
                if (isRecording) {
                    stopRecording();
                    return;
                }

                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream);
                    recordChunks = [];
                    mediaRecorder.addEventListener('dataavailable', (event) => {
                        if (event.data.size > 0) {
                            recordChunks.push(event.data);
                        }
                    });
                    mediaRecorder.addEventListener('stop', async () => {
                        stream.getTracks().forEach((track) => track.stop());
                        isRecording = false;
                        recordButton.classList.remove('is-recording');
                        recordStatus.textContent = '';
                        recordButton.disabled = false;
                        if (!recordChunks.length) {
                            return;
                        }
                        const blob = new Blob(recordChunks, { type: 'audio/webm' });
                        try {
                            const base64 = await blobToBase64(blob);
                            appendMessage('user', 'üéôÔ∏è –ì–æ–ª–æ—Å–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è');
                            await handleSend({ audioBase64: base64 });
                        } catch (error) {
                            console.error('–ü–æ–º–∏–ª–∫–∞ –æ–±—Ä–æ–±–∫–∏ –∞—É–¥—ñ–æ', error);
                            sendSystemMessage('–ù–µ –≤–¥–∞–ª–æ—Å—è –æ–±—Ä–æ–±–∏—Ç–∏ –≥–æ–ª–æ—Å–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.');
                        }
                    });
                    mediaRecorder.start();
                    isRecording = true;
                    recordButton.classList.add('is-recording');
                    recordButton.disabled = false;
                    recordStatus.textContent = '–ó–∞–ø–∏—Å—É—î–º–æ... –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å —â–µ —Ä–∞–∑, —â–æ–± –∑–∞–≤–µ—Ä—à–∏—Ç–∏.';
                } catch (error) {
                    console.error('–ü–æ–º–∏–ª–∫–∞ –¥–æ—Å—Ç—É–ø—É –¥–æ –º—ñ–∫—Ä–æ—Ñ–æ–Ω–∞', error);
                    recordStatus.textContent = '–ù–µ–º–∞—î –¥–æ—Å—Ç—É–ø—É –¥–æ –º—ñ–∫—Ä–æ—Ñ–æ–Ω–∞. –î–æ–∑–≤–æ–ª—å—Ç–µ –∑–∞–ø–∏—Å —É –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è—Ö.';
                }
            });

            // PRODUCTS
            const productGrid = document.getElementById('productGrid');
            const productsState = document.getElementById('productsState');
            let productsLoaded = false;

            async function fetchProducts(force) {
                if (productsLoaded && !force) {
                    return;
                }
                productsState.textContent = '–ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∫–∞—Ç–∞–ª–æ–≥...';
                productGrid.innerHTML = '';
                try {
                    const response = await fetch('catalog.json', { cache: force ? 'reload' : 'default' });
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}`);
                    }
                    const products = await response.json();
                    if (!Array.isArray(products) || !products.length) {
                        productsState.textContent = '–ö–∞—Ç–∞–ª–æ–≥ –ø–æ–∫–∏ –ø–æ—Ä–æ–∂–Ω—ñ–π. –°–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.';
                        return;
                    }
                    productsState.textContent = `–î–æ—Å—Ç—É–ø–Ω–æ –ø–æ–∑–∏—Ü—ñ–π: ${products.length}`;
                    productGrid.innerHTML = '';
                    const fragment = document.createDocumentFragment();
                    products.forEach((product) => {
                        const card = document.createElement('article');
                        card.classList.add('product-card');
                        const img = document.createElement('img');
                        img.alt = product.name || '–ü—Ä–æ–¥—É–∫—Ç';
                        img.loading = 'lazy';
                        img.decoding = 'async';
                        if (product.thumbnail) {
                            img.src = product.thumbnail;
                        } else if (product.image) {
                            img.src = product.image;
                        }
                        card.appendChild(img);
                        const title = document.createElement('span');
                        title.textContent = product.name || '–ë–µ–∑ –Ω–∞–∑–≤–∏';
                        card.appendChild(title);
                        card.addEventListener('click', () => {
                            openModal(product.image || product.thumbnail, product.name);
                        });
                        fragment.appendChild(card);
                    });
                    productGrid.appendChild(fragment);
                    productsLoaded = true;
                } catch (error) {
                    console.error('–ü–æ–º–∏–ª–∫–∞ –∫–∞—Ç–∞–ª–æ–≥—É', error);
                    productsState.textContent = '–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∫–∞—Ç–∞–ª–æ–≥. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∑ º—î–¥–Ω–∞–Ω–Ω—è –∞–±–æ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å ‚ü≥.';
                }
            }

            const imageModal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            const modalClose = document.getElementById('modalClose');

            function openModal(src, alt) {
                if (!src) return;
                modalImage.src = src;
                modalImage.alt = alt || '–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç—É';
                imageModal.classList.add('active');
            }

            function closeModal() {
                imageModal.classList.remove('active');
                modalImage.src = '';
            }

            modalClose.addEventListener('click', closeModal);
            imageModal.addEventListener('click', (event) => {
                if (event.target === imageModal) {
                    closeModal();
                }
            });
            document.addEventListener('keydown', (event) => {
                if (event.key === 'Escape') {
                    closeModal();
                }
            });

            // initial knowledge open first
            const firstDetails = knowledgeList.querySelector('details');
            if (firstDetails) {
                firstDetails.setAttribute('open', '');
            }
        })();
    </script>
</body>
</html>
